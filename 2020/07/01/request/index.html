<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="å‘±å‘±">
  <meta name="author" content="onePunch">
  <meta name="keywords" content="">
  <title>httpè¯·æ±‚æ–¹æ–¹é¢é¢å®‰æ’ä¸€æ³¢ - OnePunchMan</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
  

  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Fluid</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/fushishan.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-07-01 11:22">
      2020å¹´7æœˆ1æ—¥ ä¸Šåˆ
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      4.9k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      70
       åˆ†é’Ÿ
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <p>å‰è¨€ï¼šä¸‹è¾¹çš„å†…å®¹æ˜¯ä» XMLHttpRequestï¼Œåˆ°å°è£… XMLHttpRequestï¼Œå†åˆ° axiosã€‚å†™äº†å¾ˆå¤šï¼Œæ…¢æ…¢çœ‹ï½</p>
<h2 id="XMLHttpRequest"><a href="#XMLHttpRequest" class="headerlink" title="-XMLHttpRequest"></a>-XMLHttpRequest</h2><p>XMLHttpRequestï¼ˆXHRï¼‰å¯¹è±¡ç”¨äºä¸æœåŠ¡å™¨äº¤äº’ã€‚é€šè¿‡ XMLHttpRequest å¯ä»¥åœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹è¯·æ±‚ç‰¹å®š URLï¼Œè·å–æ•°æ®ã€‚è¿™å…è®¸ç½‘é¡µåœ¨ä¸å½±å“ç”¨æˆ·æ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ›´æ–°é¡µé¢çš„å±€éƒ¨å†…å®¹ã€‚XMLHttpRequest åœ¨ AJAX ç¼–ç¨‹ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚<br>å’±ä»¬ç¡¬æ ¸ä¸€ç‚¹ï¼Œç›´æ¥ä¸Šä»£ç </p>
<h4 id="ç®€å•ä¾‹å­-ğŸŒ°"><a href="#ç®€å•ä¾‹å­-ğŸŒ°" class="headerlink" title="ç®€å•ä¾‹å­ ğŸŒ°"></a>ç®€å•ä¾‹å­ ğŸŒ°</h4><pre><code class="hljs pgsql">let xhr = <span class="hljs-built_in">new</span> XMLHttpRequest();
xhr.<span class="hljs-keyword">open</span>(<span class="hljs-string">'GET'</span>,<span class="hljs-string">'https://www.baidu.com'</span>,<span class="hljs-keyword">true</span>,username,<span class="hljs-keyword">password</span>);
 // è§£é‡Šä¸€ä¸‹å‚æ•°ã€‚<span class="hljs-keyword">GET</span>é‡Šè¯·æ±‚æ–¹æ³•ï¼Œå¿…é¡»å¾—æœ‰ï¼Œhttpè¯·æ±‚æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå¸¸ç”¨post/<span class="hljs-keyword">get</span> ï¼Œè¿™é‡Œçš„å‚æ•°å†™æ³•ä¸åŒºåˆ†å¤§å°å†™ï¼Œå†™æˆâ€˜<span class="hljs-keyword">get</span>â€™ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚
 // ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¯·æ±‚çš„urlï¼Œå¿…é¡»å¾—æœ‰ã€‚
 // ç¬¬ä¸‰ä¸ªå‚æ•°è¿™é‡Œçš„<span class="hljs-keyword">true</span> ä»£è¡¨æ˜¯å¦å¼‚æ­¥ ï¼Œå¦‚æœæ˜¯<span class="hljs-keyword">true</span>å°±å¼‚æ­¥ï¼Œ<span class="hljs-keyword">false</span>å°±åŒæ­¥ ã€‚é»˜è®¤ä¸ºå¼‚æ­¥ã€‚
 // usernameï¼šå¯é€‰å‚æ•°ï¼Œå¦‚æœæœåŠ¡å™¨éœ€è¦éªŒè¯ï¼Œè¯¥å‚æ•°æŒ‡å®šç”¨æˆ·åï¼Œå¦‚æœæœªæŒ‡å®šï¼Œå½“æœåŠ¡å™¨éœ€è¦éªŒè¯æ—¶ï¼Œä¼šå¼¹å‡ºéªŒè¯çª—å£ã€‚
 // <span class="hljs-keyword">password</span>ï¼šå¯é€‰å‚æ•°ï¼ŒéªŒè¯ä¿¡æ¯ä¸­çš„å¯†ç éƒ¨åˆ†ï¼Œå¦‚æœç”¨æˆ·åä¸ºç©ºï¼Œåˆ™è¯¥å€¼å°†è¢«å¿½ç•¥ã€‚
xhr.send(body)
 // bodyæ˜¯é€šè¿‡è¯¥è¯·æ±‚å‘é€çš„å‚æ•°æ•°æ®å•¥çš„ï¼Œä¸ä¼ å°±ä¸ç”¨å¡«å†™ã€‚</code></pre>

<p>è¿™é‡Œæ’æ’­ä¸€ä¸‹è¯·æ±‚å¤±è´¥çš„é”™è¯¯ç ï¼Œæƒ³äº†ä¸€ä¸‹ï¼Œè¿˜æ˜¯æ”¾åœ¨è¿™ç¯‡æ–‡é‡Œè¾¹å§ï¼Œåæ­£å‘è¯·æ±‚å°±ä¼šæœ‰è¯·æ±‚å¤±è´¥çš„å¯èƒ½å˜›ã€‚<br>1xxï¼šæŒ‡ç¤ºä¿¡æ¯â€“è¡¨ç¤ºè¯·æ±‚å·²æ¥æ”¶ï¼Œç»§ç»­å¤„ç†ã€‚<br>2xxï¼šæˆåŠŸâ€“è¡¨ç¤ºè¯·æ±‚å·²è¢«æˆåŠŸæ¥æ”¶ã€ç†è§£ã€æ¥å—ã€‚<br>3xxï¼šé‡å®šå‘â€“è¦å®Œæˆè¯·æ±‚å¿…é¡»è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„æ“ä½œã€‚<br>4xxï¼šå®¢æˆ·ç«¯é”™è¯¯â€“è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯æˆ–è¯·æ±‚æ— æ³•å®ç°ã€‚<br>5xxï¼šæœåŠ¡å™¨ç«¯é”™è¯¯â€“æœåŠ¡å™¨æœªèƒ½å®ç°åˆæ³•çš„è¯·æ±‚ã€‚å¸¸è§çŠ¶æ€ä»£ç ã€çŠ¶æ€æè¿°çš„è¯´æ˜å¦‚ä¸‹ã€‚<br>200 OKï¼šå®¢æˆ·ç«¯è¯·æ±‚æˆåŠŸã€‚<br>400 Bad Requestï¼šå®¢æˆ·ç«¯è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯ï¼Œä¸èƒ½è¢«æœåŠ¡å™¨æ‰€ç†è§£ã€‚<br>401 Unauthorizedï¼šè¯·æ±‚æœªç»æˆæƒï¼Œè¿™ä¸ªçŠ¶æ€ä»£ç å¿…é¡»å’Œ WWW-Authenticate æŠ¥å¤´åŸŸä¸€èµ·ä½¿ç”¨ã€‚<br>403 Forbiddenï¼šæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æä¾›æœåŠ¡ã€‚<br>404 Not Foundï¼šè¯·æ±‚èµ„æºä¸å­˜åœ¨ï¼Œä¸¾ä¸ªä¾‹å­ï¼šè¾“å…¥äº†é”™è¯¯çš„ URLã€‚<br>500 Internal Server Errorï¼šæœåŠ¡å™¨å‘ç”Ÿä¸å¯é¢„æœŸçš„é”™è¯¯ã€‚<br>503 Server Unavailableï¼šæœåŠ¡å™¨å½“å‰ä¸èƒ½å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¸€æ®µæ—¶é—´åå¯èƒ½æ¢å¤æ­£å¸¸ï¼Œä¸¾ä¸ªä¾‹å­ï¼šHTTP/1.1 200 OKï¼ˆCRLFï¼‰ã€‚</p>
<p><strong>é€šå¸¸æŠ¥ 400 å¤šçš„æ—¶å€™ï¼Œå’±ä»¬å‰ç«¯å°±å·å·è‡ªå·±æ‰¾æ‰¾åŸå› ï¼ŒæŠ¥ 500 å¤šçš„æ—¶å€™ï¼Œç›´æ¥æ‰¾åç«¯å°±è¡Œã€‚</strong></p>
<p>ä¸Šè¾¹æ˜¯ä¸ªç®€å•çš„æ —å­ ğŸŒ°ï¼Œè®©æˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹çš„å¾€ä¸ŠåŠ ä¸œè¥¿ï½</p>
<h3 id="onreadystatechange"><a href="#onreadystatechange" class="headerlink" title="onreadystatechange"></a>onreadystatechange</h3><pre><code class="hljs javascript"><span class="hljs-keyword">let</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();
xhr.open(<span class="hljs-string">'GET'</span>,<span class="hljs-string">'https://www.baidu.com'</span>,<span class="hljs-literal">true</span>,username,password);

xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>&#123;
  <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.readyState === <span class="hljs-number">4</span> &amp;&amp; <span class="hljs-keyword">this</span>.status === <span class="hljs-string">'200'</span>)&#123;
    <span class="hljs-comment">// è¿™é‡Œthiså°±æ˜¯xhr this.readyState å°±æ˜¯ xhr.readyState</span>
    <span class="hljs-keyword">do</span> something
  &#125;
&#125;

xhr.send(body)</code></pre>

<p>è¿™ä¸ªæ —å­é‡Œ xhr å¤šäº†ä¸€ä¸ªå±æ€§ onreadystatechange ã€‚onreadystatechange æ˜¯ä¸€ä¸ªäº‹ä»¶å¥æŸ„ã€‚åè¾¹æ˜¯äº‹ä»¶è§¦å‘çš„å›è°ƒå‡½æ•°ã€‚å½“ XMLHttpRequest å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šè§¦å‘æ­¤å‡½æ•°ã€‚çŠ¶æ€ä» 0 (uninitialized) åˆ° 4 (complete) è¿›è¡Œå˜åŒ–ã€‚ä»…åœ¨çŠ¶æ€ä¸º 4 æ—¶ï¼Œæˆ‘ä»¬æ‰æ‰§è¡Œä»£ç ã€‚</p>
<p><em>è¡¥å……ä¸€ä¸‹ readyState çš„çŸ¥è¯†ï¼Œçœ‹çœ‹çŸ¥é“æœ‰è¿™ä¹ˆä¸ªäº‹å°±è¡Œã€‚</em><br><em>0 æœªåˆå§‹åŒ–ã€‚è¡¨ç¤ºå¯¹è±¡å·²ç»å»ºç«‹ï¼Œä½†æ˜¯å°šæœªåˆå§‹åŒ–ï¼Œå°šæœªè°ƒç”¨ open() æ–¹æ³•</em><br><em>1 åˆå§‹åŒ–ã€‚è¡¨ç¤ºå¯¹è±¡å·²ç»å»ºç«‹ï¼Œå°šæœªè°ƒç”¨ send() æ–¹æ³•</em><br><em>2 å‘é€æ•°æ®ã€‚è¡¨ç¤º send() æ–¹æ³•å·²ç»è°ƒç”¨ï¼Œä½†æ˜¯å½“å‰çš„çŠ¶æ€åŠ HTTP å¤´æœªçŸ¥</em><br><em>3 æ•°æ®ä¼ é€ä¸­ã€‚å·²ç»æ¥æ”¶éƒ¨åˆ†æ•°æ®ï¼Œå› ä¸ºå“åº”åŠ HTTP å¤´ä¸å®‰å…¨ï¼Œè¿™æ—¶é€šè¿‡ responseBody å’Œ responseText è·å–éƒ¨åˆ†æ•°æ®ä¼šå‡ºç°é”™è¯¯</em><br><em>4 å®Œæˆã€‚æ•°æ®æ¥æ”¶å®Œæ¯•ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡ responseBody å’Œ responseText è·å–å®Œæ•´çš„å“åº”æ•°æ®</em></p>
<h3 id="å¦‚ä½•è®¾ç½®-request-header"><a href="#å¦‚ä½•è®¾ç½®-request-header" class="headerlink" title="å¦‚ä½•è®¾ç½® request header"></a>å¦‚ä½•è®¾ç½® request header</h3><p>setRequestHeader(name, value)</p>
<p>name å‚æ•°æ˜¯è¦è®¾ç½®çš„å¤´éƒ¨çš„åç§°ã€‚è¿™ä¸ªå‚æ•°ä¸åº”è¯¥åŒ…æ‹¬ç©ºç™½ã€å†’å·æˆ–æ¢è¡Œã€‚<br>value å‚æ•°æ˜¯å¤´éƒ¨çš„å€¼ã€‚è¿™ä¸ªå‚æ•°ä¸åº”è¯¥åŒ…æ‹¬æ¢è¡Œã€‚</p>
<pre><code class="hljs vhdl">let xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();
xhr.<span class="hljs-keyword">open</span>(<span class="hljs-symbol">'GET</span>',<span class="hljs-symbol">'https</span>://www.baidu.com',<span class="hljs-literal">true</span>,username,password);


xhr.setRequestHeader(<span class="hljs-symbol">'Content</span>-<span class="hljs-keyword">Type</span>', <span class="hljs-symbol">'one</span>');
xhr.setRequestHeader(<span class="hljs-symbol">'Content</span>-<span class="hljs-keyword">Type</span>', <span class="hljs-symbol">'two</span>');
// æœ€ç»ˆrequest headerä¸­<span class="hljs-string">"Content-Type"</span>ä¸º: one, two

xhr.send(<span class="hljs-keyword">body</span>)</code></pre>

<p>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•° header å¤§å°å†™ä¸æ•æ„Ÿï¼Œå³å¯ä»¥å†™æˆ content-typeï¼Œä¹Ÿå¯ä»¥å†™æˆ Content-Typeï¼Œç”šè‡³å†™æˆ content-Typeã€‚</p>
<p>Content-Type çš„é»˜è®¤å€¼ä¸å…·ä½“å‘é€çš„æ•°æ®ç±»å‹æœ‰å…³ã€‚</p>
<p>setRequestHeader å¿…é¡»åœ¨ open()æ–¹æ³•ä¹‹åï¼Œsend()æ–¹æ³•ä¹‹å‰è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ›é”™ã€‚</p>
<p>setRequestHeader å¯ä»¥è°ƒç”¨å¤šæ¬¡ï¼Œæœ€ç»ˆçš„å€¼ä¸ä¼šé‡‡ç”¨è¦†ç›– override çš„æ–¹å¼ï¼Œè€Œæ˜¯é‡‡ç”¨è¿½åŠ  append çš„æ–¹å¼ã€‚</p>
<h3 id="å¦‚ä½•æŒ‡å®š-xhr-response-çš„æ•°æ®ç±»å‹"><a href="#å¦‚ä½•æŒ‡å®š-xhr-response-çš„æ•°æ®ç±»å‹" class="headerlink" title="å¦‚ä½•æŒ‡å®š xhr.response çš„æ•°æ®ç±»å‹"></a>å¦‚ä½•æŒ‡å®š xhr.response çš„æ•°æ®ç±»å‹</h3><p>xhr.overrideMimeType(â€˜text/plain; charset=utf-8â€™) // xhr level 1 ä½¿ç”¨çš„æ–¹æ³•ã€‚</p>
<p>xhr.responseType = â€˜blobâ€™ // xhr level 2 å¯ä»¥ç”¨çš„ï¼Œæ¯”ä¸Šé¢ç®€å•å¾ˆå¤šï¼Œä½†æ˜¯è¯´æ˜¯å…¼å®¹æ€§ç¨å¾®å·®ä¸€ç‚¹ç‚¹ã€‚ä¸è¿‡æˆ‘æ²¡å‘ç°è¿‡ä»»ä½•é—®é¢˜ï¼Œæ¨èç”¨ä¸‹è¾¹çš„å†™æ³•</p>
<h3 id="å¦‚ä½•è®¾ç½®è¯·æ±‚çš„è¶…æ—¶æ—¶é—´"><a href="#å¦‚ä½•è®¾ç½®è¯·æ±‚çš„è¶…æ—¶æ—¶é—´" class="headerlink" title="å¦‚ä½•è®¾ç½®è¯·æ±‚çš„è¶…æ—¶æ—¶é—´"></a>å¦‚ä½•è®¾ç½®è¯·æ±‚çš„è¶…æ—¶æ—¶é—´</h3><p>å¦‚æœè¯·æ±‚è¿‡äº†å¾ˆä¹…è¿˜æ²¡æœ‰æˆåŠŸï¼Œä¸ºäº†ä¸ä¼šç™½ç™½å ç”¨çš„ç½‘ç»œèµ„æºï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä¸»åŠ¨ç»ˆæ­¢è¯·æ±‚ã€‚XMLHttpRequest æä¾›äº† timeout å±æ€§æ¥å…è®¸è®¾ç½®è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ã€‚<br>xhr.timeout = 0<br>å•ä½ï¼šmilliseconds æ¯«ç§’<br>é»˜è®¤å€¼ï¼š0ï¼Œå³ä¸è®¾ç½®è¶…æ—¶</p>
<p>âš ï¸ æ³¨æ„ï¼š<strong>å½“ xhr ä¸ºä¸€ä¸ª sync åŒæ­¥è¯·æ±‚æ—¶</strong>ï¼Œxhr.timeout å¿…é¡»ç½®ä¸º 0ï¼Œå¦åˆ™ä¼šæŠ›é”™ã€‚å¹¶ä¸” xhr.withCredentials å¿…é¡»ä¸º false</p>
<p>xhr.responseType å¿…é¡»ä¸ºâ€â€ï¼ˆæ³¨æ„ç½®ä¸ºâ€textâ€ä¹Ÿä¸å…è®¸ï¼‰</p>
<h3 id="å¦‚ä½•è·å–ä¸Šä¼ ã€ä¸‹è½½çš„è¿›åº¦"><a href="#å¦‚ä½•è·å–ä¸Šä¼ ã€ä¸‹è½½çš„è¿›åº¦" class="headerlink" title="å¦‚ä½•è·å–ä¸Šä¼ ã€ä¸‹è½½çš„è¿›åº¦"></a>å¦‚ä½•è·å–ä¸Šä¼ ã€ä¸‹è½½çš„è¿›åº¦</h3><p>åœ¨ä¸Šä¼ æˆ–è€…ä¸‹è½½æ¯”è¾ƒå¤§çš„æ–‡ä»¶æ—¶ï¼Œå®æ—¶æ˜¾ç¤ºå½“å‰çš„ä¸Šä¼ ã€ä¸‹è½½è¿›åº¦æ˜¯å¾ˆæ™®éçš„äº§å“éœ€æ±‚ã€‚<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡ onprogress äº‹ä»¶æ¥å®æ—¶æ˜¾ç¤ºè¿›åº¦ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªäº‹ä»¶æ¯ 50ms è§¦å‘ä¸€æ¬¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šä¼ è¿‡ç¨‹å’Œä¸‹è½½è¿‡ç¨‹è§¦å‘çš„æ˜¯ä¸åŒå¯¹è±¡çš„ onprogress äº‹ä»¶ï¼š</p>
<p>ä¸Šä¼ è§¦å‘çš„æ˜¯ xhr.upload å¯¹è±¡çš„ onprogress äº‹ä»¶</p>
<p>ä¸‹è½½è§¦å‘çš„æ˜¯ xhr å¯¹è±¡çš„ onprogress äº‹ä»¶</p>
<pre><code class="hljs cs">
xhr.onprogress = updateProgress;
xhr.upload.onprogress = updateProgress;
<span class="hljs-function">function <span class="hljs-title">updateProgress</span>(<span class="hljs-params"><span class="hljs-keyword">event</span></span>)</span> &#123;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span>.lengthComputable) &#123;
      <span class="hljs-keyword">var</span> completedPercent = <span class="hljs-keyword">event</span>.loaded / <span class="hljs-keyword">event</span>.total;
    &#125;
 &#125;</code></pre>

<h3 id="å¦‚ä½•æ‰èƒ½ä¸­æ­¢è¯·æ±‚"><a href="#å¦‚ä½•æ‰èƒ½ä¸­æ­¢è¯·æ±‚" class="headerlink" title="å¦‚ä½•æ‰èƒ½ä¸­æ­¢è¯·æ±‚"></a>å¦‚ä½•æ‰èƒ½ä¸­æ­¢è¯·æ±‚</h3><p>xhr.onreadystatechange = function () {}; //æ¸…ç†äº‹ä»¶å“åº”å‡½æ•°<br>xhr.abort(); //ä¸­æ­¢è¯·æ±‚</p>
<p>åœ¨è°ƒç”¨ abort() æ–¹æ³•å‰ï¼Œåº”å…ˆæ¸…é™¤ onreadystatechange äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå› ä¸º IE å’Œ Mozilla åœ¨è¯·æ±‚ä¸­æ­¢åä¹Ÿä¼šæ¿€æ´»è¿™ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ã€‚å¦‚æœç»™ onreadystatechange å±æ€§è®¾ç½®ä¸º nullï¼Œåˆ™ IE ä¼šå‘ç”Ÿå¼‚å¸¸ï¼Œæ‰€ä»¥ä¸ºå®ƒè®¾ç½®ä¸€ä¸ªç©ºå‡½æ•°ã€‚</p>
<h3 id="è¯·æ±‚æˆåŠŸçš„å›è°ƒ"><a href="#è¯·æ±‚æˆåŠŸçš„å›è°ƒ" class="headerlink" title="è¯·æ±‚æˆåŠŸçš„å›è°ƒ"></a>è¯·æ±‚æˆåŠŸçš„å›è°ƒ</h3><p>å‰é¢å†™è¿‡ï¼Œå°±æ˜¯åœ¨ onreadystatechange åˆ¤æ–­ readyState == 4 ã€‚ã€‚ã€‚ã€‚ã€‚å»ä¸Šé¢çœ‹å“ˆ<br>å½“ç„¶å•¦ ï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œä¹Ÿæ˜¯æˆ‘æ¯”è¾ƒæ¨èçš„ï¼Œ</p>
<pre><code class="hljs lua">xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span></span> &#123;
   //å¦‚æœè¯·æ±‚æˆåŠŸ
   <span class="hljs-keyword">if</span>((xhr.<span class="hljs-built_in">status</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; xhr.<span class="hljs-built_in">status</span> &lt; <span class="hljs-number">300</span>) || xhr.<span class="hljs-built_in">status</span> == <span class="hljs-number">304</span>)&#123;
     //<span class="hljs-keyword">do</span> successCallback
   &#125;
 &#125;</code></pre>

<h3 id="æ¯”è¾ƒå®Œæ•´çš„-http-è¯·æ±‚ï¼Œæ–¹ä¾¿å¤§å®¶ç”¨çš„æ—¶å€™å¤åˆ¶ç²˜è´´ï¼Œå˜¿å˜¿"><a href="#æ¯”è¾ƒå®Œæ•´çš„-http-è¯·æ±‚ï¼Œæ–¹ä¾¿å¤§å®¶ç”¨çš„æ—¶å€™å¤åˆ¶ç²˜è´´ï¼Œå˜¿å˜¿" class="headerlink" title="æ¯”è¾ƒå®Œæ•´çš„ http è¯·æ±‚ï¼Œæ–¹ä¾¿å¤§å®¶ç”¨çš„æ—¶å€™å¤åˆ¶ç²˜è´´ï¼Œå˜¿å˜¿"></a>æ¯”è¾ƒå®Œæ•´çš„ http è¯·æ±‚ï¼Œæ–¹ä¾¿å¤§å®¶ç”¨çš„æ—¶å€™å¤åˆ¶ç²˜è´´ï¼Œå˜¿å˜¿</h3><pre><code class="hljs javascript"> <span class="hljs-keyword">let</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();
<span class="hljs-comment">// è¯·æ±‚æˆåŠŸå›è°ƒå‡½æ•°</span>
xhr.onload = <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request success'</span>);
&#125;;
<span class="hljs-comment">// è¯·æ±‚ç»“æŸ</span>
xhr.onloadend = <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request loadend'</span>);
&#125;;
<span class="hljs-comment">// è¯·æ±‚å‡ºé”™</span>
xhr.onerror = <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request error'</span>);
&#125;;
<span class="hljs-comment">// è¯·æ±‚è¶…æ—¶</span>
xhr.ontimeout = <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request timeout'</span>);
&#125;;
<span class="hljs-comment">// è¯·æ±‚å›è°ƒå‡½æ•°.XMLHttpRequestæ ‡å‡†åˆåˆ†ä¸ºLevel 1å’ŒLevel 2,è¿™æ˜¯Level 1å’Œçš„å›è°ƒå¤„ç†æ–¹å¼</span>
<span class="hljs-comment">// xhr.onreadystatechange = () =&gt; &#123;</span>
<span class="hljs-comment">//  if (xhr.readyState !== 4) &#123;</span>
<span class="hljs-comment">//  return;</span>
<span class="hljs-comment">//  &#125;</span>
<span class="hljs-comment">//  const status = xhr.status;</span>
<span class="hljs-comment">//  if ((status &gt;= 200 &amp;&amp; status &lt; 300) || status === 304) &#123;</span>
<span class="hljs-comment">//  console.log('request success');</span>
<span class="hljs-comment">//  &#125; else &#123;</span>
<span class="hljs-comment">//  console.log('request error');</span>
<span class="hljs-comment">//  &#125;</span>
<span class="hljs-comment">//  &#125;;</span>

xhr.timeout = <span class="hljs-number">0</span>; <span class="hljs-comment">// è®¾ç½®è¶…æ—¶æ—¶é—´,0è¡¨ç¤ºæ°¸ä¸è¶…æ—¶</span>
<span class="hljs-comment">// åˆå§‹åŒ–è¯·æ±‚</span>
xhr.open(<span class="hljs-string">'GET/POST/DELETE/...'</span>, <span class="hljs-string">'/url'</span>, <span class="hljs-literal">true</span> || <span class="hljs-literal">false</span>);
<span class="hljs-comment">// è®¾ç½®æœŸæœ›çš„è¿”å›æ•°æ®ç±»å‹ 'json' 'text' 'document' ...</span>
xhr.responseType = <span class="hljs-string">''</span>;
<span class="hljs-comment">// è®¾ç½®è¯·æ±‚å¤´</span>
xhr.setRequestHeader(<span class="hljs-string">''</span>, <span class="hljs-string">''</span>);
<span class="hljs-comment">// å‘é€è¯·æ±‚</span>
xhr.send(<span class="hljs-literal">null</span> || <span class="hljs-keyword">new</span> FormData || <span class="hljs-string">'a=1&amp;b=2'</span> || <span class="hljs-string">'jsonå­—ç¬¦ä¸²'</span>);</code></pre>

<h2 id="å°è£…-XMLHttpRequest"><a href="#å°è£…-XMLHttpRequest" class="headerlink" title="-å°è£… XMLHttpRequest"></a>-å°è£… XMLHttpRequest</h2><h3 id="åˆæ­¥å°è£…"><a href="#åˆæ­¥å°è£…" class="headerlink" title="åˆæ­¥å°è£…"></a>åˆæ­¥å°è£…</h3><p>ä¸‹é¢çš„ä»£ç æœ‰ç‚¹å¤šï¼Œä¸çˆ±çœ‹å¯ä»¥ä¸çœ‹ï¼Œæ²¡ä»€ä¹ˆéš¾ç‚¹ã€‚å¤§ä½“æ€è·¯æˆ‘è¿™é‡Œå‘Šè¯‰ä½ ï¼š<br>å…ˆå†™ä¸€ä¸ªé»˜è®¤çš„è¯·æ±‚éœ€è¦çš„ä¸€äº›å‚æ•°å•¥çš„ï¼Œæ¯”å¦‚é»˜è®¤ get æ–¹æ³•ï¼Œé»˜è®¤å¼‚æ­¥è¯·æ±‚ç­‰ã€‚<br>å¦‚æœæ˜¯ get è¯·æ±‚ï¼ŒæŠŠè¯·æ±‚å‚æ•°æ”¾è¿› url é‡Œé¢æ ¼å¼ä¸º <a href="https://www.wanghaojvlao.com?wanghao=jvlao&amp;wanghao=shadiaoè¿™æ ·" target="_blank" rel="noopener">https://www.wanghaojvlao.com?wanghao=jvlao&amp;wanghao=shadiaoè¿™æ ·</a><br>å¦‚æœæ˜¯ postï¼Œè½¬åŒ–è¯·æ±‚ä½“ä¸­çš„ date ç±»å‹ä¸ºå­—ç¬¦ä¸²ç±»å‹<br>å¤§æ¦‚æ€è·¯å°±æ˜¯è¿™æ ·ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï½</p>
<pre><code class="hljs typescript"><span class="hljs-keyword">const</span> http = &#123;
  <span class="hljs-comment">/**</span>
<span class="hljs-comment">   * jså°è£…ajaxè¯·æ±‚</span>
<span class="hljs-comment">   * &gt;&gt;ä½¿ç”¨new XMLHttpRequest åˆ›å»ºè¯·æ±‚å¯¹è±¡,æ‰€ä»¥ä¸è€ƒè™‘ä½ç«¯IEæµè§ˆå™¨(IE6åŠä»¥ä¸‹ä¸æ”¯æŒXMLHttpRequest)</span>
<span class="hljs-comment">   * &gt;&gt;ä½¿ç”¨es6è¯­æ³•,å¦‚æœéœ€è¦åœ¨æ­£å¼ç¯å¢ƒä½¿ç”¨,åˆ™å¯ä»¥ç”¨babelè½¬æ¢ä¸ºes5è¯­æ³• https://babeljs.cn/docs/setup/#installation</span>
<span class="hljs-comment">   *  @param settings è¯·æ±‚å‚æ•°æ¨¡ä»¿jQuery ajax</span>
<span class="hljs-comment">   *  è°ƒç”¨è¯¥æ–¹æ³•,dataå‚æ•°éœ€è¦å’Œè¯·æ±‚å¤´Content-Typeå¯¹åº”</span>
<span class="hljs-comment">   *  Content-Type                        data                                     æè¿°</span>
<span class="hljs-comment">   *  application/x-www-form-urlencoded   'name=å“ˆå“ˆ&amp;age=12'æˆ–&#123;name:'å“ˆå“ˆ',age:12&#125;  æŸ¥è¯¢å­—ç¬¦ä¸²,ç”¨&amp;åˆ†å‰²</span>
<span class="hljs-comment">   *  application/json                     name=å“ˆå“ˆ&amp;age=12'                        jsonå­—ç¬¦ä¸²</span>
<span class="hljs-comment">   *  multipart/form-data                  new FormData()                           FormDataå¯¹è±¡,å½“ä¸ºFormDataç±»å‹,ä¸è¦æ‰‹åŠ¨è®¾ç½®Content-Type</span>
<span class="hljs-comment">   *  æ³¨æ„:è¯·æ±‚å‚æ•°å¦‚æœåŒ…å«æ—¥æœŸç±»å‹.æ˜¯å¦èƒ½è¯·æ±‚æˆåŠŸéœ€è¦åå°æ¥å£é…åˆ</span>
<span class="hljs-comment">   */</span>
  ajax: <span class="hljs-function">(<span class="hljs-params">settings = &#123;&#125;</span>) =&gt;</span> &#123;
    <span class="hljs-comment">// åˆå§‹åŒ–è¯·æ±‚å‚æ•°</span>
    <span class="hljs-keyword">let</span> _s = <span class="hljs-built_in">Object</span>.assign(&#123;
      url: <span class="hljs-string">''</span>, <span class="hljs-comment">// string</span>
      <span class="hljs-keyword">type</span>: <span class="hljs-string">'GET'</span>, <span class="hljs-comment">// string 'GET' 'POST' 'DELETE'</span>
      dataType: <span class="hljs-string">'json'</span>, <span class="hljs-comment">// string æœŸæœ›çš„è¿”å›æ•°æ®ç±»å‹:'json' 'text' 'document' ...</span>
      <span class="hljs-keyword">async</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">//  boolean true:å¼‚æ­¥è¯·æ±‚ false:åŒæ­¥è¯·æ±‚ required</span>
      data: <span class="hljs-literal">null</span>, <span class="hljs-comment">// any è¯·æ±‚å‚æ•°,dataéœ€è¦å’Œè¯·æ±‚å¤´Content-Typeå¯¹åº”</span>
      headers: &#123;&#125;, <span class="hljs-comment">// object è¯·æ±‚å¤´</span>
      timeout: <span class="hljs-number">1000</span>, <span class="hljs-comment">// string è¶…æ—¶æ—¶é—´:0è¡¨ç¤ºä¸è®¾ç½®è¶…æ—¶</span>
      beforeSend: <span class="hljs-function">(<span class="hljs-params">xhr</span>) =&gt;</span> &#123;
      &#125;,
      success: <span class="hljs-function">(<span class="hljs-params">result, status, xhr</span>) =&gt;</span> &#123;
      &#125;,
      error: <span class="hljs-function">(<span class="hljs-params">xhr, status, error</span>) =&gt;</span> &#123;
      &#125;,
      complete: <span class="hljs-function">(<span class="hljs-params">xhr, status</span>) =&gt;</span> &#123;
      &#125;
    &#125;, settings);
    <span class="hljs-comment">// å‚æ•°éªŒè¯</span>
    <span class="hljs-keyword">if</span> (!_s.url || !_s.type || !_s.dataType || !_s.async) &#123;
      alert(<span class="hljs-string">'å‚æ•°æœ‰è¯¯'</span>);
      <span class="hljs-keyword">return</span>;
    &#125;
    <span class="hljs-comment">// åˆ›å»ºXMLHttpRequestè¯·æ±‚å¯¹è±¡</span>
    <span class="hljs-keyword">let</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();
    <span class="hljs-comment">// è¯·æ±‚å¼€å§‹å›è°ƒå‡½æ•°</span>
    xhr.addEventListener(<span class="hljs-string">'loadstart'</span>, <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;
      _s.beforeSend(xhr);
    &#125;);
    <span class="hljs-comment">// è¯·æ±‚æˆåŠŸå›è°ƒå‡½æ•°</span>
    xhr.addEventListener(<span class="hljs-string">'load'</span>, <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;
      <span class="hljs-keyword">const</span> status = xhr.status;
      <span class="hljs-keyword">if</span> ((status &gt;= <span class="hljs-number">200</span> &amp;&amp; status &lt; <span class="hljs-number">300</span>) || status === <span class="hljs-number">304</span>) &#123;
        <span class="hljs-keyword">let</span> result;
        <span class="hljs-keyword">if</span> (xhr.responseType === <span class="hljs-string">'text'</span>) &#123;
          result = xhr.responseText;
        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (xhr.responseType === <span class="hljs-string">'document'</span>) &#123;
          result = xhr.responseXML;
        &#125; <span class="hljs-keyword">else</span> &#123;
          result = xhr.response;
        &#125;
        <span class="hljs-comment">// æ³¨æ„:çŠ¶æ€ç 200è¡¨ç¤ºè¯·æ±‚å‘é€/æ¥å—æˆåŠŸ,ä¸è¡¨ç¤ºä¸šåŠ¡å¤„ç†æˆåŠŸ</span>
        _s.success(result, status, xhr);
      &#125; <span class="hljs-keyword">else</span> &#123;
        _s.error(xhr, status, e);
      &#125;
    &#125;);
    <span class="hljs-comment">// è¯·æ±‚ç»“æŸ</span>
    xhr.addEventListener(<span class="hljs-string">'loadend'</span>, <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;
      _s.complete(xhr, xhr.status);
    &#125;);
    <span class="hljs-comment">// è¯·æ±‚å‡ºé”™</span>
    xhr.addEventListener(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;
      _s.error(xhr, xhr.status, e);
    &#125;);
    <span class="hljs-comment">// è¯·æ±‚è¶…æ—¶</span>
    xhr.addEventListener(<span class="hljs-string">'timeout'</span>, <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;
      _s.error(xhr, <span class="hljs-number">408</span>, e);
    &#125;);
    <span class="hljs-keyword">let</span> useUrlParam = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">let</span> sType = _s.type.toUpperCase();
    <span class="hljs-comment">// å¦‚æœæ˜¯"ç®€å•"è¯·æ±‚,åˆ™æŠŠdataå‚æ•°ç»„è£…åœ¨urlä¸Š</span>
    <span class="hljs-keyword">if</span> (sType === <span class="hljs-string">'GET'</span> || sType === <span class="hljs-string">'DELETE'</span>) &#123;
      useUrlParam = <span class="hljs-literal">true</span>;
      _s.url += http.getUrlParam(_s.url, _s.data);
    &#125;
    <span class="hljs-comment">// åˆå§‹åŒ–è¯·æ±‚</span>

    xhr.open(_s.type, _s.url, _s.async);
    <span class="hljs-comment">// è®¾ç½®æœŸæœ›çš„è¿”å›æ•°æ®ç±»å‹</span>
    xhr.responseType = _s.dataType;
    <span class="hljs-comment">// è®¾ç½®è¯·æ±‚å¤´</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key of <span class="hljs-built_in">Object</span>.keys(_s.headers)) &#123;
      xhr.setRequestHeader(key, _s.headers[key]);
    &#125;
    <span class="hljs-comment">// è®¾ç½®è¶…æ—¶æ—¶é—´</span>
    <span class="hljs-keyword">if</span> (_s.async &amp;&amp; _s.timeout) &#123;
      xhr.timeout = _s.timeout;
    &#125;
    <span class="hljs-comment">// å‘é€è¯·æ±‚.å¦‚æœæ˜¯ç®€å•è¯·æ±‚,è¯·æ±‚å‚æ•°åº”ä¸ºnull.å¦åˆ™,è¯·æ±‚å‚æ•°ç±»å‹éœ€è¦å’Œè¯·æ±‚å¤´Content-Typeå¯¹åº”</span>
    xhr.send(useUrlParam ? <span class="hljs-literal">null</span> : http.getQueryData(_s.data));
  &#125;,
  <span class="hljs-comment">// æŠŠå‚æ•°dataè½¬ä¸ºurlæŸ¥è¯¢å‚æ•°</span>
  getUrlParam: <span class="hljs-function">(<span class="hljs-params">url, data</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">if</span> (!data) &#123;
      <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
    &#125;
    <span class="hljs-keyword">let</span> paramsStr = data <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Object</span> ? http.getQueryString(data) : data;
    <span class="hljs-keyword">return</span> (url.indexOf(<span class="hljs-string">'?'</span>) !== <span class="hljs-number">-1</span>) ? paramsStr : <span class="hljs-string">'?'</span> + paramsStr;
  &#125;,
  <span class="hljs-comment">// è·å–ajaxè¯·æ±‚å‚æ•°</span>
  getQueryData: <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">if</span> (!data) &#123;
      <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    &#125;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> data === <span class="hljs-string">'string'</span>) &#123;
      <span class="hljs-keyword">return</span> data;
    &#125;
    <span class="hljs-keyword">if</span> (data <span class="hljs-keyword">instanceof</span> FormData) &#123;
      <span class="hljs-keyword">return</span> data;
    &#125;
    <span class="hljs-keyword">return</span> http.getQueryString(data);
  &#125;,
  <span class="hljs-comment">// æŠŠå¯¹è±¡è½¬ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²</span>
  getQueryString: <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">let</span> paramsArr = [];
    <span class="hljs-keyword">if</span> (data <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Object</span>) &#123;
      <span class="hljs-built_in">Object</span>.keys(data).forEach(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> &#123;
        <span class="hljs-keyword">let</span> val = data[key];
        <span class="hljs-comment">// todo å‚æ•°Dateç±»å‹éœ€è¦æ ¹æ®åå°apié…Œæƒ…å¤„ç†</span>
        <span class="hljs-keyword">if</span> (val <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Date</span>) &#123;
          <span class="hljs-comment">// val = dateFormat(val, 'yyyy-MM-dd hh:mm:ss');</span>
        &#125;
        paramsArr.push(<span class="hljs-built_in">encodeURIComponent</span>(key) + <span class="hljs-string">'='</span> + <span class="hljs-built_in">encodeURIComponent</span>(val));
      &#125;);
    &#125;
    <span class="hljs-keyword">return</span> paramsArr.join(<span class="hljs-string">'&amp;'</span>);
  &#125;
&#125;</code></pre>

<p>è¿™æ—¶å€™è°ƒç”¨çš„ä»£ç åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs coffeescript">http.ajax(&#123;
  url: url,
  type: <span class="hljs-string">'POST'</span>,
  data: &#123;name: <span class="hljs-string">'å“ˆå“ˆ'</span>, age: <span class="hljs-number">12</span>&#125;, <span class="hljs-regexp">//</span>æˆ– data: <span class="hljs-string">'name=å“ˆå“ˆ&amp;age=12'</span>,
  headers: &#123;
    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/x-www-form-urlencoded; charset=UTF-8'</span>
  &#125;,
  beforeSend: <span class="hljs-function"><span class="hljs-params">(xhr)</span> =&gt;</span> &#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request show loading...'</span>);
  &#125;,
  success: function (result, status, xhr) &#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request success...'</span>);
  &#125;,
  error: <span class="hljs-function"><span class="hljs-params">(xhr, status, error)</span> =&gt;</span> &#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request error...'</span>);
  &#125;,
  complete: <span class="hljs-function"><span class="hljs-params">(xhr, status)</span> =&gt;</span> &#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request hide loading...'</span>);
  &#125;
&#125;);</code></pre>

<p>å¯ä»¥çœ‹å‡ºæ¥å“ˆï¼Œè¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œä½ æ€»ä¸èƒ½æ¯æ¬¡è¯·æ±‚éƒ½æ•´çœŸä¹ˆä¸€å¤§å †ä»£ç å§ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­å°è£…ï¼</p>
<h3 id="è¿›ä¸€æ­¥å°è£…"><a href="#è¿›ä¸€æ­¥å°è£…" class="headerlink" title="è¿›ä¸€æ­¥å°è£…"></a>è¿›ä¸€æ­¥å°è£…</h3><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> http = &#123;
  <span class="hljs-comment">/**</span>
<span class="hljs-comment">   * æ ¹æ®å®é™…ä¸šåŠ¡æƒ…å†µè£…é¥° ajax æ–¹æ³•</span>
<span class="hljs-comment">   * å¦‚:ç»Ÿä¸€å¼‚å¸¸å¤„ç†,æ·»åŠ httpè¯·æ±‚å¤´,è¯·æ±‚å±•ç¤ºloadingç­‰</span>
<span class="hljs-comment">   * <span class="hljs-doctag">@param <span class="hljs-variable">settings</span></span></span>
<span class="hljs-comment">   */</span>
  request: <span class="hljs-function">(<span class="hljs-params">settings = &#123;&#125;</span>) =&gt;</span> &#123;
    <span class="hljs-comment">// ç»Ÿä¸€å¼‚å¸¸å¤„ç†å‡½æ•°</span>
    <span class="hljs-keyword">let</span> errorHandle = <span class="hljs-function">(<span class="hljs-params">xhr, status</span>) =&gt;</span> &#123;
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request error...'</span>);
      <span class="hljs-keyword">if</span> (status === <span class="hljs-number">401</span>) &#123;
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request æ²¡æœ‰æƒé™...'</span>);
      &#125;
      <span class="hljs-keyword">if</span> (status === <span class="hljs-number">408</span>) &#123;
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request timeout'</span>);
      &#125;
    &#125;;
    <span class="hljs-comment">// ä½¿ç”¨beforeæ‹¦æˆªå‚æ•°çš„ beforeSend å›è°ƒå‡½æ•°</span>
    settings.beforeSend = (settings.beforeSend || <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
    &#125;).before(<span class="hljs-function"><span class="hljs-params">xhr</span> =&gt;</span> &#123;
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request show loading...'</span>);
    &#125;);
    <span class="hljs-comment">// ä¿å­˜å‚æ•°successå›è°ƒå‡½æ•°</span>
    <span class="hljs-keyword">let</span> successFn = settings.success;
    <span class="hljs-comment">// è¦†ç›–å‚æ•°successå›è°ƒå‡½æ•°</span>
    settings.success = <span class="hljs-function">(<span class="hljs-params">result, status, xhr</span>) =&gt;</span> &#123;
      <span class="hljs-comment">// todo æ ¹æ®åå°apiåˆ¤æ–­æ˜¯å¦è¯·æ±‚æˆåŠŸ</span>
      <span class="hljs-keyword">if</span> (result &amp;&amp; result <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Object</span> &amp;&amp; result.code !== <span class="hljs-number">1</span>) &#123;
        errorHandle(xhr, status);
      &#125; <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request success'</span>);
        successFn &amp;&amp; successFn(result, status, xhr);
      &#125;
    &#125;;
    <span class="hljs-comment">// æ‹¦æˆªå‚æ•°çš„ error</span>
    settings.error = (settings.error || <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
    &#125;).before(<span class="hljs-function">(<span class="hljs-params">result, status, xhr</span>) =&gt;</span> &#123;
      errorHandle(xhr, status);
    &#125;);
    <span class="hljs-comment">// æ‹¦æˆªå‚æ•°çš„ complete</span>
    settings.complete = (settings.complete || <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
    &#125;).after(<span class="hljs-function">(<span class="hljs-params">xhr, status</span>) =&gt;</span> &#123;
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request hide loading...'</span>);
    &#125;);
    <span class="hljs-comment">// è¯·æ±‚æ·»åŠ æƒé™å¤´,ç„¶åè°ƒç”¨http.ajaxæ–¹æ³•</span>
    (http.ajax.before(http.addAuthorizationHeader))(settings);
  &#125;,
  <span class="hljs-comment">// æ·»åŠ æƒé™è¯·æ±‚å¤´</span>
  addAuthorizationHeader: <span class="hljs-function">(<span class="hljs-params">settings</span>) =&gt;</span> &#123;
    settings.headers = settings.headers || &#123;&#125;;
    <span class="hljs-keyword">const</span> headerKey = <span class="hljs-string">'Authorization'</span>; <span class="hljs-comment">// todo æƒé™å¤´åç§°</span>
    <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨æƒé™header</span>
    <span class="hljs-keyword">let</span> hasAuthorization = <span class="hljs-built_in">Object</span>.keys(settings.headers).some(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> &#123;
      <span class="hljs-keyword">return</span> key === headerKey;
    &#125;);
    <span class="hljs-keyword">if</span> (!hasAuthorization) &#123;
      settings.headers[headerKey] = <span class="hljs-string">'test'</span>; <span class="hljs-comment">// todo ä»ç¼“å­˜ä¸­è·å–headerKeyçš„å€¼</span>
    &#125;
  &#125;
&#125;;

<span class="hljs-built_in">Function</span>.prototype.before = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">beforeFn</span>) </span>&#123; <span class="hljs-comment">// eslint-disable-line</span>
  <span class="hljs-keyword">let</span> _self = <span class="hljs-keyword">this</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
    beforeFn.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    _self.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
  &#125;;
&#125;;

<span class="hljs-built_in">Function</span>.prototype.after = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">afterFn</span>) </span>&#123; <span class="hljs-comment">// eslint-disable-line</span>
  <span class="hljs-keyword">let</span> _self = <span class="hljs-keyword">this</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
    _self.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    afterFn.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
  &#125;;
&#125;;</code></pre>

<p>å¥½æäº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬è°ƒç”¨çš„ä»£ç æ›´ç®€æ´äº›äº†ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs javascript">http.request(&#123;
  url: url,
  type: <span class="hljs-string">'POST'</span>,
  data: &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">'å“ˆå“ˆ'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">12</span>&#125;, <span class="hljs-comment">// data: 'name=å“ˆå“ˆ&amp;age=12',</span>
  headers: &#123;
    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/x-www-form-urlencoded; charset=UTF-8'</span>
  &#125;,
  success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">result, status, xhr</span>) </span>&#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'å°±å¯ä»¥æ“ä½œä¸€æ³¢å•¦'</span>);
  &#125;
&#125;);




<span class="hljs-comment">//å¯¹æ¯”ä¸‹åˆšåˆšçš„</span>
http.ajax(&#123;
  url: url,
  type: <span class="hljs-string">'POST'</span>,
  data: &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">'å“ˆå“ˆ'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">12</span>&#125;, <span class="hljs-comment">//æˆ– data: 'name=å“ˆå“ˆ&amp;age=12',</span>
  headers: &#123;
    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/x-www-form-urlencoded; charset=UTF-8'</span>
  &#125;,
  beforeSend: <span class="hljs-function">(<span class="hljs-params">xhr</span>) =&gt;</span> &#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request show loading...'</span>);
  &#125;,
  success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">result, status, xhr</span>) </span>&#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request success...'</span>);
  &#125;,
  error: <span class="hljs-function">(<span class="hljs-params">xhr, status, error</span>) =&gt;</span> &#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request error...'</span>);
  &#125;,
  complete: <span class="hljs-function">(<span class="hljs-params">xhr, status</span>) =&gt;</span> &#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'request hide loading...'</span>);
  &#125;
&#125;);</code></pre>

<p>å˜¿å˜¿ï¼Œä¸è¦åœï¼Œè®©æˆ‘ä»¬ç»§ç»­å°è£…ä¸€ä¸‹ï½ ğŸ˜</p>
<h3 id="ç»ˆæå°è£…"><a href="#ç»ˆæå°è£…" class="headerlink" title="ç»ˆæå°è£…"></a>ç»ˆæå°è£…</h3><pre><code class="hljs lasso">const http = &#123;
  get: (url, <span class="hljs-built_in">data</span>, successCallback, dataType = <span class="hljs-string">'json'</span>) =&gt; &#123;
    http.request(&#123;
      url: url,
      <span class="hljs-keyword">type</span>: <span class="hljs-string">'GET'</span>,
      dataType: dataType,
      <span class="hljs-built_in">data</span>: <span class="hljs-built_in">data</span>,
      success: successCallback
    &#125;);
  &#125;,
  delete: (url, <span class="hljs-built_in">data</span>, successCallback, dataType = <span class="hljs-string">'json'</span>) =&gt; &#123;
    http.request(&#123;
      url: url,
      <span class="hljs-keyword">type</span>: <span class="hljs-string">'DELETE'</span>,
      dataType: dataType,
      <span class="hljs-built_in">data</span>: <span class="hljs-built_in">data</span>,
      success: successCallback
    &#125;);
  &#125;,
  <span class="hljs-comment">// è°ƒç”¨æ­¤æ–¹æ³•,å‚æ•°dataåº”ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²æˆ–æ™®é€šå¯¹è±¡</span>
  post: (url, <span class="hljs-built_in">data</span>, successCallback, dataType = <span class="hljs-string">'json'</span>) =&gt; &#123;
    http.request(&#123;
      url: url,
      <span class="hljs-keyword">type</span>: <span class="hljs-string">'POST'</span>,
      dataType: dataType,
      <span class="hljs-built_in">data</span>: <span class="hljs-built_in">data</span>,
      headers: &#123;
        <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/x-www-form-urlencoded; charset=UTF-8'</span>
      &#125;,
      success: successCallback
    &#125;);
  &#125;,
  <span class="hljs-comment">// è°ƒç”¨æ­¤æ–¹æ³•,å‚æ•°dataåº”ä¸ºjsonå­—ç¬¦ä¸²</span>
  postBody: (url, <span class="hljs-built_in">data</span>, successCallback, dataType = <span class="hljs-string">'json'</span>) =&gt; &#123;
    http.request(&#123;
      url: url,
      <span class="hljs-keyword">type</span>: <span class="hljs-string">'POST'</span>,
      dataType: dataType,
      <span class="hljs-built_in">data</span>: <span class="hljs-built_in">data</span>,
      headers: &#123;
        <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json; charset=UTF-8'</span>
      &#125;,
      success: successCallback
    &#125;);
  &#125;
&#125;;</code></pre>

<p>æ­¤æ—¶ï¼Œæ­¤æ—¶æ­¤åˆ»ï¼Œright now ï¼ let us see see ğŸ˜‚</p>
<pre><code class="hljs coffeescript">http.get(url + <span class="hljs-string">'?name=å“ˆå“ˆ&amp;age=12'</span>, <span class="hljs-literal">null</span>, <span class="hljs-function"><span class="hljs-params">(result, status, xhr)</span> =&gt;</span> &#123;
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'ä½ éšä¾¿å¹²å•¥éƒ½è¡Œå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ'</span>);
&#125;);</code></pre>

<p>ç¥ä¼¼ jquery çš„ $.ajax() å¯¹ä¸å¯¹ï¼Ÿå¾ˆå¼€å¿ƒäº†è§£äº†è¿™ä¹ˆå¤šä¸œè¥¿å§ï½ï¼Œok é‚£ä¹ˆæˆ‘ä»¬æ¥ç€çœ‹ä¸‹ä¸€ä¸ªç©æ„å„¿ï½</p>
<h2 id="axios"><a href="#axios" class="headerlink" title="-axios"></a>-axios</h2><h3 id="axios-ç®€ä»‹"><a href="#axios-ç®€ä»‹" class="headerlink" title="axios ç®€ä»‹"></a>axios ç®€ä»‹</h3><p>Axios æ˜¯ä¸€ä¸ªåŸºäº promise çš„ HTTP åº“ï¼Œå¯ä»¥ç”¨åœ¨æµè§ˆå™¨å’Œ node.js ä¸­ã€‚</p>
<p><strong>ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>ä»æµè§ˆå™¨ä¸­åˆ›å»º XMLHttpRequests</li>
<li>ä» node.js åˆ›å»º http è¯·æ±‚</li>
<li>æ”¯æŒ Promise API</li>
<li>æ‹¦æˆªè¯·æ±‚å’Œå“åº”</li>
<li>è½¬æ¢è¯·æ±‚æ•°æ®å’Œå“åº”æ•°æ®</li>
<li>å–æ¶ˆè¯·æ±‚</li>
<li>è‡ªåŠ¨è½¬æ¢ JSON æ•°æ®</li>
<li>å®¢æˆ·ç«¯æ”¯æŒé˜²å¾¡ XSRF</li>
</ul>
<p>é‚£ä¹ˆ axios å’Œ ajax çš„åŒºåˆ«åœ¨å“ªé‡Œå‘¢ï¼Ÿaxios å’Œ XMLHttpRequest å…³è”åˆåœ¨å“ªé‡Œå‘¢ï¼Ÿ<br>Axios åœ¨ NPM ä¸Šçš„æè¿°æ˜¯ï¼šPromise based HTTP client for the browser and node.jsï¼Œæ˜¯ä¸€ç§åŸºäº Promise å°è£…çš„ HTTP å®¢æˆ·ç«¯ã€‚<br>AJAX å®Œæ•´æ˜¯ Asynchronous Javascript And XML . å¼‚æ­¥ js å’Œ xmlï¼Œæ˜¯ä¸€ç§å¼‚æ­¥è¯·æ±‚çš„æŠ€æœ¯ã€‚</p>
<p>å•¥æ„æ€ï¼ŸAxios æ˜¯é€šè¿‡ Promise å®ç° XHR å°è£…ï¼Œå…¶ä¸­ Promise æ˜¯æ§åˆ¶æ‰‹æ®µï¼ŒXHR æ˜¯å®é™…å‘é€ Http è¯·æ±‚çš„å®¢æˆ·ç«¯ã€‚å°±åƒ$.ajax æ˜¯é€šè¿‡ callback+XHR å®ç°ä¸€æ ·å°±åƒæˆ‘ä»¬åˆšåˆšåœ¨ä¸Šé¢å°è£…çš„é‚£ä¸ªä¸€ä¸ªæ„æ€çš„ï¼Œéƒ½æ˜¯ AJAX æŠ€æœ¯çš„ä¸€ç§è¿ç”¨ã€‚ AJAX æŠ€æœ¯æ˜¯å®ç°ç½‘é¡µçš„å±€éƒ¨æ•°æ®åˆ·æ–°ï¼Œä½ å¯ä»¥é€šè¿‡ XHRã€Fetchã€WebSocket ç­‰ API å®ç°ã€‚</p>
<h3 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h3><p>ç¡¬æ ¸ä¸€ç‚¹ï¼Œç›´æ¥ä¸Šå®˜ç½‘ä»£ç ï¼Œä¸€ç›®äº†ç„¶ï½</p>
<pre><code class="hljs scilab"><span class="hljs-comment">// get</span>
axios.get(<span class="hljs-string">'/user'</span>, &#123;
    params: &#123;
      ID: <span class="hljs-number">12345</span>
    &#125;
  &#125;)
  .<span class="hljs-keyword">then</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(response)</span> &#123;</span>
    console.<span class="hljs-built_in">log</span>(response);
  &#125;)
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(error)</span> &#123;</span>
    console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">error</span>);
  &#125;);

<span class="hljs-comment">// post</span>
axios.post(<span class="hljs-string">'/user'</span>, &#123;
    firstName: <span class="hljs-string">'Fred'</span>,
    lastName: <span class="hljs-string">'Flintstone'</span>
  &#125;)
  .<span class="hljs-keyword">then</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(response)</span> &#123;</span>
    console.<span class="hljs-built_in">log</span>(response);
  &#125;)
  .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(error)</span> &#123;</span>
    console.<span class="hljs-built_in">log</span>(<span class="hljs-built_in">error</span>);
  &#125;);

<span class="hljs-comment">// å¹¶å‘</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUserAccount</span><span class="hljs-params">()</span> &#123;</span>
  <span class="hljs-keyword">return</span> axios.get(<span class="hljs-string">'/user/12345'</span>);
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getUserPermissions</span><span class="hljs-params">()</span> &#123;</span>
  <span class="hljs-keyword">return</span> axios.get(<span class="hljs-string">'/user/12345/permissions'</span>);
&#125;

axios.all([getUserAccount(), getUserPermissions()])
  .<span class="hljs-keyword">then</span>(axios.spread(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(acct, perms)</span> &#123;</span>
    <span class="hljs-comment">// ä¸¤ä¸ªè¯·æ±‚ç°åœ¨éƒ½æ‰§è¡Œå®Œæˆ</span>
  &#125;));</code></pre>

<h3 id="EXTRA"><a href="#EXTRA" class="headerlink" title="EXTRA"></a>EXTRA</h3><p>æ•´ç‚¹é¢å¤–çš„æƒŠå–œï¼Œç¡¬æ ¸èµ·æ¥ä¸Šä»£ç ï¼</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;
<span class="hljs-keyword">import</span> &#123; getLocale &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'umi-plugin-react/locale'</span>;
<span class="hljs-keyword">import</span> &#123; getToken &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'../token'</span>;


<span class="hljs-comment">// Add a request interceptor  è¿™æ˜¯åŠ ä¸ªæ‹¦æˆªå™¨ï¼Œåœ¨requestå‘é€ä¹‹å‰ï¼Œå¯ä»¥åšä¸€äº›æ“ä½œçš„ï½</span>
axios.interceptors.request.use(
  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>&#123;
    <span class="hljs-comment">// Do something before request is sent</span>
    <span class="hljs-keyword">return</span> config;
  &#125;,
  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>&#123;
    <span class="hljs-comment">// Do something with request error</span>
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(error);
  &#125;
);

<span class="hljs-comment">// Add a response interceptor è¿™ä¹Ÿæ˜¯ä¸ªæ‹¦æˆªï¼Œåœ¨è¿”å›responseä¹‹å‰ä¹Ÿå¯ä»¥æ“ä½œä¸€æ³¢ï¼Œè¿™é‡Œåšäº†ä¸ªå¦‚æœè¯·æ±‚å¤±è´¥ï¼Œè‡ªåŠ¨é‡æ–°è¯·æ±‚çš„æ“ä½œ</span>
axios.interceptors.response.use(
  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>&#123;
    <span class="hljs-comment">// Do something with response data</span>
    <span class="hljs-keyword">return</span> response;
  &#125;,
  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>&#123;
    <span class="hljs-comment">// Do something with response error</span>
    <span class="hljs-keyword">const</span> &#123; config, response &#125; = error;
    <span class="hljs-keyword">if</span> (config) &#123;
      <span class="hljs-keyword">if</span> (
        config.retry &amp;&amp;
        [<span class="hljs-string">'get'</span>, <span class="hljs-string">'put'</span>, <span class="hljs-string">'delete'</span>].includes(config.method) &amp;&amp;
        (!response || (response.status &gt;= <span class="hljs-number">500</span> &amp;&amp; response.status &lt;= <span class="hljs-number">599</span>))
      ) &#123;
        <span class="hljs-keyword">const</span> &#123; headers &#125; = config;
        <span class="hljs-keyword">const</span> retryCountHeaderKey = <span class="hljs-string">'X-Retry-Count'</span>;
        <span class="hljs-keyword">const</span> retryCountHeaderValue = <span class="hljs-built_in">parseInt</span>(headers[retryCountHeaderKey] || <span class="hljs-string">'0'</span>, <span class="hljs-number">10</span>) + <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (retryCountHeaderValue &lt;= <span class="hljs-number">3</span>) &#123; <span class="hljs-comment">// å¦‚æœå¤±è´¥ï¼Œè‡ªåŠ¨è¯·æ±‚3æ¬¡</span>
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> &#123;
            setTimeout(
              () =&gt;
                resolve(
                  axios(&#123;
                    ...config,
                    headers: &#123;
                      ...headers,
                      [retryCountHeaderKey]: <span class="hljs-string">`<span class="hljs-subst">$&#123;retryCountHeaderValue&#125;</span>`</span>,
                    &#125;,
                  &#125;)
                ),
              <span class="hljs-number">1000</span> * retryCountHeaderValue
            );
          &#125;);
        &#125;
      &#125; <span class="hljs-comment">// é‡å‘â€œå®‰å…¨è¯·æ±‚â€</span>
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(error);
  &#125;
);

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * request æ–¹æ³•ï¼Œaxios çš„ç®€å•å°è£…</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">request</span>(<span class="hljs-params">url, config = &#123;&#125;</span>) </span>&#123;
  axios.defaults.headers.common.Authorization = getToken(); <span class="hljs-comment">// è·å– token</span>
  axios.defaults.headers.common[<span class="hljs-string">'Accept-Language'</span>] = <span class="hljs-string">`<span class="hljs-subst">$&#123;getLocale()&#125;</span>;q=0.9`</span>; <span class="hljs-comment">// å›½é™…åŒ–â€œAccept-Language:zh-CN,zh;q=0.9â€ =&gt; zh-CN æˆ– en-US</span>

  <span class="hljs-keyword">const</span> &#123;
    method = <span class="hljs-string">'get'</span>,
    responseType,
    body = &#123;&#125;,
    headers = &#123;&#125;,
    cache = <span class="hljs-literal">false</span>,
    download = <span class="hljs-literal">false</span>,
    retry = <span class="hljs-literal">true</span>, <span class="hljs-comment">// eslint-disable-line</span>
    ...rest
  &#125; = config;

  <span class="hljs-keyword">const</span> newBody = <span class="hljs-regexp">/(put|post|patch)/i</span>.test(method) ? &#123; <span class="hljs-attr">data</span>: body &#125; : &#123; <span class="hljs-attr">params</span>: body &#125;; <span class="hljs-comment">// data å‚æ•°ï¼Œåœ¨ä»¥ä¸‹â€œè¯·æ±‚ç±»å‹â€ä¸­å¯ç”¨ï¼šput, post, patch</span>

  <span class="hljs-keyword">const</span> newResponseType = responseType || (download ? <span class="hljs-string">'arraybuffer'</span> : <span class="hljs-string">'json'</span>);

  <span class="hljs-keyword">return</span> axios
    .request(&#123;
      url, <span class="hljs-comment">// URL åœ°å€</span>
      method, <span class="hljs-comment">// è¯·æ±‚ç±»å‹ï¼Œget, post, put, delete...</span>
      responseType: newResponseType, <span class="hljs-comment">// å“åº”æ•°æ®ç±»å‹</span>

      headers: &#123;
        ...headers,
        ...(cache
          ? &#123; <span class="hljs-string">'Cache-Control'</span>: <span class="hljs-string">'public, max-age=86400'</span> &#125;
          : &#123; <span class="hljs-string">'Cache-Control'</span>: <span class="hljs-string">'no-cache, no-store, must-revalidate'</span>, <span class="hljs-attr">Pragma</span>: <span class="hljs-string">'no-cache'</span> &#125;),
      &#125;,

      ...newBody, <span class="hljs-comment">// è¯·æ±‚å‚æ•°</span>

      ...rest, <span class="hljs-comment">// å‰©ä½™å‚æ•°</span>
    &#125;)
    .then(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> (&#123;
      success: <span class="hljs-literal">true</span>,
      response,
    &#125;))
    .catch(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> &#123;
      <span class="hljs-keyword">const</span> &#123; response &#125; = error;
      <span class="hljs-keyword">const</span> &#123; status &#125; = response;

      <span class="hljs-keyword">const</span> errorName = <span class="hljs-string">`Error<span class="hljs-subst">$&#123;status&#125;</span> - <span class="hljs-subst">$&#123;response.config.url&#125;</span>`</span>;
      <span class="hljs-keyword">const</span> errorMessage = response.statusText;
      <span class="hljs-built_in">console</span>.log(errorName);
      <span class="hljs-built_in">console</span>.log(errorMessage);

<span class="hljs-comment">//  å¦‚æœä¸æ˜¯ç™»é™†é¡µï¼Œä½†æ˜¯çŠ¶æ€ç 401 é‚£ä¹ˆè·³è½¬é¡µé¢åˆ°ç™»é™†é¡µ</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.location.href.indexOf(<span class="hljs-string">'login'</span>) === <span class="hljs-number">-1</span> &amp;&amp; status === <span class="hljs-number">401</span>) &#123;
        <span class="hljs-built_in">window</span>.location.href = <span class="hljs-string">`/g/login?redirect=<span class="hljs-subst">$&#123;</span></span>
<span class="hljs-string"><span class="hljs-subst">          <span class="hljs-built_in">window</span>.location.href.split(<span class="hljs-built_in">window</span>.location.host)[<span class="hljs-number">1</span>]</span></span>
<span class="hljs-string"><span class="hljs-subst">        &#125;</span>`</span>;
      &#125;

      <span class="hljs-keyword">return</span> &#123;
        success: <span class="hljs-literal">false</span>,
        response: &#123; ...response, <span class="hljs-attr">data</span>: response.data || &#123; <span class="hljs-attr">message</span>: <span class="hljs-string">'504 Gateway Timeout'</span> &#125; &#125;,
      &#125;;
    &#125;);
&#125;</code></pre>

<h4 id="åœ¨é¡¹ç›®ä¸­çš„ç”¨æ³•"><a href="#åœ¨é¡¹ç›®ä¸­çš„ç”¨æ³•" class="headerlink" title="åœ¨é¡¹ç›®ä¸­çš„ç”¨æ³•"></a>åœ¨é¡¹ç›®ä¸­çš„ç”¨æ³•</h4><pre><code class="hljs typescript">onClick=&#123;<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
     <span class="hljs-keyword">this</span>.setState(&#123;
       spinning: <span class="hljs-literal">true</span>,
     &#125;);
     request(<span class="hljs-string">`/server/api/declarationfiles/<span class="hljs-subst">$&#123;record.id&#125;</span>`</span>, &#123;
       method: <span class="hljs-string">'get'</span>,
       download: <span class="hljs-literal">true</span>,
       onDownloadProgress: <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> &#123;
         <span class="hljs-keyword">if</span> (e.loaded / e.total === <span class="hljs-number">1</span>) &#123;
           <span class="hljs-keyword">this</span>.setState(&#123;
             spinning: <span class="hljs-literal">false</span>,
           &#125;);
         &#125;
       &#125;,
     &#125;).then(<span class="hljs-function"><span class="hljs-params">wrappedResponse</span> =&gt;</span> &#123;
       <span class="hljs-keyword">const</span> &#123; response &#125; = wrappedResponse;
       download(record.fileName, response.data);
     &#125;);
   &#125;&#125;


       <span class="hljs-comment">//  ç›´æ¥åœ¨é¡µé¢é‡Œå†™è¯·æ±‚ï¼Œé€‚ç”¨äºè°ƒç”¨æ¬¡æ•°å°‘ï¼Œç‹¬ç«‹ä¸“å±äºæŸä¸ªé¡µé¢ä½¿ç”¨çš„æƒ…å†µã€‚æ¯”å¦‚æ–‡ä»¶ä¸‹è½½ç­‰</span></code></pre>

<hr>
<pre><code class="hljs typescript">*retrieveRules(&#123; payload &#125;, &#123; call, put, select &#125;) &#123;
    <span class="hljs-keyword">const</span> newRules = <span class="hljs-keyword">yield</span> select(<span class="hljs-function"><span class="hljs-params">models</span> =&gt;</span> &#123;
      <span class="hljs-keyword">const</span> &#123; pagination, searcher &#125; = models[<span class="hljs-keyword">namespace</span>];
      <span class="hljs-keyword">return</span> &#123;
        pagination,
        searcher,
        ...payload,
      &#125;;
    &#125;);
    <span class="hljs-keyword">const</span> &#123; pagination, searcher &#125; = newRules;
    <span class="hljs-keyword">const</span> wrappedResponse = <span class="hljs-keyword">yield</span> call(request, <span class="hljs-string">`/server/api/projectwarningrules`</span>, &#123;
      method: <span class="hljs-string">'get'</span>,
      body: &#123;
        ...pagination,
        ...searcher,
      &#125;,
    &#125;);
&#125;

             <span class="hljs-comment">// å†™åœ¨model å±‚çš„effecté‡Œé¢ï¼Œé€‚ç”¨äºè°ƒç”¨æ¬¡æ•°å¤šï¼Œ æ¯”å¦‚è¯·æ±‚åˆ—è¡¨æ•°æ®ï¼Œå¢åˆ æ”¹æŸ¥æ“ä½œåéœ€è¦å†æ¬¡è°ƒç”¨è¯·æ±‚æ•°æ®</span></code></pre>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/XMLHttpRequest-request-axios/">XMLHttpRequest request axios</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/06/24/network-protocol/">
                        <span class="hidden-mobile">ç½‘ç»œåè®®</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
              <!-- Comments -->
              <div class="comments" id="comments">
                
                

              </div>
            
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>







  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "httpè¯·æ±‚æ–¹æ–¹é¢é¢å®‰æ’ä¸€æ³¢&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>




















</body>
</html>
