---
title: ä»XMLHttpRequeståˆ°å°è£…è¯·æ±‚æ–¹æ³•å†åˆ°axios
date: 2020-07-01 11:22:06
tags: XMLHttpRequest request axios
---

XMLHttpRequestï¼ˆXHRï¼‰å¯¹è±¡ç”¨äºä¸æœåŠ¡å™¨äº¤äº’ã€‚é€šè¿‡ XMLHttpRequest å¯ä»¥åœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹è¯·æ±‚ç‰¹å®š URLï¼Œè·å–æ•°æ®ã€‚è¿™å…è®¸ç½‘é¡µåœ¨ä¸å½±å“ç”¨æˆ·æ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ›´æ–°é¡µé¢çš„å±€éƒ¨å†…å®¹ã€‚XMLHttpRequest åœ¨ AJAX ç¼–ç¨‹ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚

## XMLHttpRequest

å’±ä»¬ç¡¬æ ¸ä¸€ç‚¹ï¼Œç›´æ¥ä¸Šä»£ç 

#### ç®€å•ä¾‹å­ ğŸŒ°

```
let xhr = new XMLHttpRequest();
xhr.open('GET','https://www.baidu.com',true,username,password);
 // è§£é‡Šä¸€ä¸‹å‚æ•°ã€‚GETé‡Šè¯·æ±‚æ–¹æ³•ï¼Œå¿…é¡»å¾—æœ‰ï¼Œhttpè¯·æ±‚æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå¸¸ç”¨post/get ï¼Œè¿™é‡Œçš„å‚æ•°å†™æ³•ä¸åŒºåˆ†å¤§å°å†™ï¼Œå†™æˆâ€˜getâ€™ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚
 // ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¯·æ±‚çš„urlï¼Œå¿…é¡»å¾—æœ‰ã€‚
 // ç¬¬ä¸‰ä¸ªå‚æ•°è¿™é‡Œçš„true ä»£è¡¨æ˜¯å¦å¼‚æ­¥ ï¼Œå¦‚æœæ˜¯trueå°±å¼‚æ­¥ï¼Œfalseå°±åŒæ­¥ ã€‚é»˜è®¤ä¸ºå¼‚æ­¥ã€‚
 // usernameï¼šå¯é€‰å‚æ•°ï¼Œå¦‚æœæœåŠ¡å™¨éœ€è¦éªŒè¯ï¼Œè¯¥å‚æ•°æŒ‡å®šç”¨æˆ·åï¼Œå¦‚æœæœªæŒ‡å®šï¼Œå½“æœåŠ¡å™¨éœ€è¦éªŒè¯æ—¶ï¼Œä¼šå¼¹å‡ºéªŒè¯çª—å£ã€‚
 // passwordï¼šå¯é€‰å‚æ•°ï¼ŒéªŒè¯ä¿¡æ¯ä¸­çš„å¯†ç éƒ¨åˆ†ï¼Œå¦‚æœç”¨æˆ·åä¸ºç©ºï¼Œåˆ™è¯¥å€¼å°†è¢«å¿½ç•¥ã€‚
xhr.send(body)
 // bodyæ˜¯é€šè¿‡è¯¥è¯·æ±‚å‘é€çš„å‚æ•°æ•°æ®å•¥çš„ï¼Œä¸ä¼ å°±ä¸ç”¨å¡«å†™ã€‚

```

è¿™é‡Œæ’æ’­ä¸€ä¸‹è¯·æ±‚å¤±è´¥çš„é”™è¯¯ç ï¼Œæƒ³äº†ä¸€ä¸‹ï¼Œè¿˜æ˜¯æ”¾åœ¨è¿™ç¯‡æ–‡é‡Œè¾¹å§ï¼Œåæ­£å‘è¯·æ±‚å°±ä¼šæœ‰è¯·æ±‚å¤±è´¥çš„å¯èƒ½å˜›ã€‚
1xxï¼šæŒ‡ç¤ºä¿¡æ¯--è¡¨ç¤ºè¯·æ±‚å·²æ¥æ”¶ï¼Œç»§ç»­å¤„ç†ã€‚
2xxï¼šæˆåŠŸ--è¡¨ç¤ºè¯·æ±‚å·²è¢«æˆåŠŸæ¥æ”¶ã€ç†è§£ã€æ¥å—ã€‚
3xxï¼šé‡å®šå‘--è¦å®Œæˆè¯·æ±‚å¿…é¡»è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„æ“ä½œã€‚
4xxï¼šå®¢æˆ·ç«¯é”™è¯¯--è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯æˆ–è¯·æ±‚æ— æ³•å®ç°ã€‚
5xxï¼šæœåŠ¡å™¨ç«¯é”™è¯¯--æœåŠ¡å™¨æœªèƒ½å®ç°åˆæ³•çš„è¯·æ±‚ã€‚å¸¸è§çŠ¶æ€ä»£ç ã€çŠ¶æ€æè¿°çš„è¯´æ˜å¦‚ä¸‹ã€‚
200 OKï¼šå®¢æˆ·ç«¯è¯·æ±‚æˆåŠŸã€‚
400 Bad Requestï¼šå®¢æˆ·ç«¯è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯ï¼Œä¸èƒ½è¢«æœåŠ¡å™¨æ‰€ç†è§£ã€‚
401 Unauthorizedï¼šè¯·æ±‚æœªç»æˆæƒï¼Œè¿™ä¸ªçŠ¶æ€ä»£ç å¿…é¡»å’Œ WWW-Authenticate æŠ¥å¤´åŸŸä¸€èµ·ä½¿ç”¨ã€‚
403 Forbiddenï¼šæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æä¾›æœåŠ¡ã€‚
404 Not Foundï¼šè¯·æ±‚èµ„æºä¸å­˜åœ¨ï¼Œä¸¾ä¸ªä¾‹å­ï¼šè¾“å…¥äº†é”™è¯¯çš„ URLã€‚
500 Internal Server Errorï¼šæœåŠ¡å™¨å‘ç”Ÿä¸å¯é¢„æœŸçš„é”™è¯¯ã€‚
503 Server Unavailableï¼šæœåŠ¡å™¨å½“å‰ä¸èƒ½å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¸€æ®µæ—¶é—´åå¯èƒ½æ¢å¤æ­£å¸¸ï¼Œä¸¾ä¸ªä¾‹å­ï¼šHTTP/1.1 200 OKï¼ˆCRLFï¼‰ã€‚

**é€šå¸¸æŠ¥ 400 å¤šçš„æ—¶å€™ï¼Œå’±ä»¬å‰ç«¯å°±å·å·è‡ªå·±æ‰¾æ‰¾åŸå› ï¼ŒæŠ¥ 500 å¤šçš„æ—¶å€™ï¼Œç›´æ¥æ‰¾åç«¯å°±è¡Œã€‚**

ä¸Šè¾¹æ˜¯ä¸ªç®€å•çš„æ —å­ ğŸŒ°ï¼Œè®©æˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹çš„å¾€ä¸ŠåŠ ä¸œè¥¿ï½

### onreadystatechange

```
let xhr = new XMLHttpRequest();
xhr.open('GET','https://www.baidu.com',true,username,password);

xhr.onreadystatechange = function(e){
  if(this.readyState === 4 && this.status === '200'){
    // è¿™é‡Œthiså°±æ˜¯xhr this.readyState å°±æ˜¯ xhr.readyState
    do something
  }
}

xhr.send(body)


```

è¿™ä¸ªæ —å­é‡Œ xhr å¤šäº†ä¸€ä¸ªå±æ€§ onreadystatechange ã€‚onreadystatechange æ˜¯ä¸€ä¸ªäº‹ä»¶å¥æŸ„ã€‚åè¾¹æ˜¯äº‹ä»¶è§¦å‘çš„å›è°ƒå‡½æ•°ã€‚å½“ XMLHttpRequest å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šè§¦å‘æ­¤å‡½æ•°ã€‚çŠ¶æ€ä» 0 (uninitialized) åˆ° 4 (complete) è¿›è¡Œå˜åŒ–ã€‚ä»…åœ¨çŠ¶æ€ä¸º 4 æ—¶ï¼Œæˆ‘ä»¬æ‰æ‰§è¡Œä»£ç ã€‚

_è¡¥å……ä¸€ä¸‹ readyState çš„çŸ¥è¯†ï¼Œçœ‹çœ‹çŸ¥é“æœ‰è¿™ä¹ˆä¸ªäº‹å°±è¡Œã€‚_
_0 æœªåˆå§‹åŒ–ã€‚è¡¨ç¤ºå¯¹è±¡å·²ç»å»ºç«‹ï¼Œä½†æ˜¯å°šæœªåˆå§‹åŒ–ï¼Œå°šæœªè°ƒç”¨ open() æ–¹æ³•_
_1 åˆå§‹åŒ–ã€‚è¡¨ç¤ºå¯¹è±¡å·²ç»å»ºç«‹ï¼Œå°šæœªè°ƒç”¨ send() æ–¹æ³•_
_2 å‘é€æ•°æ®ã€‚è¡¨ç¤º send() æ–¹æ³•å·²ç»è°ƒç”¨ï¼Œä½†æ˜¯å½“å‰çš„çŠ¶æ€åŠ HTTP å¤´æœªçŸ¥_
_3 æ•°æ®ä¼ é€ä¸­ã€‚å·²ç»æ¥æ”¶éƒ¨åˆ†æ•°æ®ï¼Œå› ä¸ºå“åº”åŠ HTTP å¤´ä¸å®‰å…¨ï¼Œè¿™æ—¶é€šè¿‡ responseBody å’Œ responseText è·å–éƒ¨åˆ†æ•°æ®ä¼šå‡ºç°é”™è¯¯_
_4 å®Œæˆã€‚æ•°æ®æ¥æ”¶å®Œæ¯•ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡ responseBody å’Œ responseText è·å–å®Œæ•´çš„å“åº”æ•°æ®_

### å¦‚ä½•è®¾ç½® request header

setRequestHeader(name, value)

name å‚æ•°æ˜¯è¦è®¾ç½®çš„å¤´éƒ¨çš„åç§°ã€‚è¿™ä¸ªå‚æ•°ä¸åº”è¯¥åŒ…æ‹¬ç©ºç™½ã€å†’å·æˆ–æ¢è¡Œã€‚
value å‚æ•°æ˜¯å¤´éƒ¨çš„å€¼ã€‚è¿™ä¸ªå‚æ•°ä¸åº”è¯¥åŒ…æ‹¬æ¢è¡Œã€‚

```
let xhr = new XMLHttpRequest();
xhr.open('GET','https://www.baidu.com',true,username,password);


xhr.setRequestHeader('Content-Type', 'one');
xhr.setRequestHeader('Content-Type', 'two');
// æœ€ç»ˆrequest headerä¸­"Content-Type"ä¸º: one, two

xhr.send(body)


```

æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•° header å¤§å°å†™ä¸æ•æ„Ÿï¼Œå³å¯ä»¥å†™æˆ content-typeï¼Œä¹Ÿå¯ä»¥å†™æˆ Content-Typeï¼Œç”šè‡³å†™æˆ content-Typeã€‚

Content-Type çš„é»˜è®¤å€¼ä¸å…·ä½“å‘é€çš„æ•°æ®ç±»å‹æœ‰å…³ã€‚

setRequestHeader å¿…é¡»åœ¨ open()æ–¹æ³•ä¹‹åï¼Œsend()æ–¹æ³•ä¹‹å‰è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ›é”™ã€‚

setRequestHeader å¯ä»¥è°ƒç”¨å¤šæ¬¡ï¼Œæœ€ç»ˆçš„å€¼ä¸ä¼šé‡‡ç”¨è¦†ç›– override çš„æ–¹å¼ï¼Œè€Œæ˜¯é‡‡ç”¨è¿½åŠ  append çš„æ–¹å¼ã€‚

### å¦‚ä½•æŒ‡å®š xhr.response çš„æ•°æ®ç±»å‹

xhr.overrideMimeType('text/plain; charset=utf-8') // xhr level 1 ä½¿ç”¨çš„æ–¹æ³•ã€‚

xhr.responseType = 'blob' // xhr level 2 å¯ä»¥ç”¨çš„ï¼Œæ¯”ä¸Šé¢ç®€å•å¾ˆå¤šï¼Œä½†æ˜¯è¯´æ˜¯å…¼å®¹æ€§ç¨å¾®å·®ä¸€ç‚¹ç‚¹ã€‚ä¸è¿‡æˆ‘æ²¡å‘ç°è¿‡ä»»ä½•é—®é¢˜ï¼Œæ¨èç”¨ä¸‹è¾¹çš„å†™æ³•

### å¦‚ä½•è®¾ç½®è¯·æ±‚çš„è¶…æ—¶æ—¶é—´

å¦‚æœè¯·æ±‚è¿‡äº†å¾ˆä¹…è¿˜æ²¡æœ‰æˆåŠŸï¼Œä¸ºäº†ä¸ä¼šç™½ç™½å ç”¨çš„ç½‘ç»œèµ„æºï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä¸»åŠ¨ç»ˆæ­¢è¯·æ±‚ã€‚XMLHttpRequest æä¾›äº† timeout å±æ€§æ¥å…è®¸è®¾ç½®è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ã€‚
xhr.timeout = 0
å•ä½ï¼šmilliseconds æ¯«ç§’
é»˜è®¤å€¼ï¼š0ï¼Œå³ä¸è®¾ç½®è¶…æ—¶

âš ï¸ æ³¨æ„ï¼š**å½“ xhr ä¸ºä¸€ä¸ª sync åŒæ­¥è¯·æ±‚æ—¶**ï¼Œxhr.timeout å¿…é¡»ç½®ä¸º 0ï¼Œå¦åˆ™ä¼šæŠ›é”™ã€‚å¹¶ä¸” xhr.withCredentials å¿…é¡»ä¸º false

xhr.responseType å¿…é¡»ä¸º""ï¼ˆæ³¨æ„ç½®ä¸º"text"ä¹Ÿä¸å…è®¸ï¼‰

### å¦‚ä½•è·å–ä¸Šä¼ ã€ä¸‹è½½çš„è¿›åº¦

åœ¨ä¸Šä¼ æˆ–è€…ä¸‹è½½æ¯”è¾ƒå¤§çš„æ–‡ä»¶æ—¶ï¼Œå®æ—¶æ˜¾ç¤ºå½“å‰çš„ä¸Šä¼ ã€ä¸‹è½½è¿›åº¦æ˜¯å¾ˆæ™®éçš„äº§å“éœ€æ±‚ã€‚
æˆ‘ä»¬å¯ä»¥é€šè¿‡ onprogress äº‹ä»¶æ¥å®æ—¶æ˜¾ç¤ºè¿›åº¦ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªäº‹ä»¶æ¯ 50ms è§¦å‘ä¸€æ¬¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šä¼ è¿‡ç¨‹å’Œä¸‹è½½è¿‡ç¨‹è§¦å‘çš„æ˜¯ä¸åŒå¯¹è±¡çš„ onprogress äº‹ä»¶ï¼š

ä¸Šä¼ è§¦å‘çš„æ˜¯ xhr.upload å¯¹è±¡çš„ onprogress äº‹ä»¶

ä¸‹è½½è§¦å‘çš„æ˜¯ xhr å¯¹è±¡çš„ onprogress äº‹ä»¶

```

xhr.onprogress = updateProgress;
xhr.upload.onprogress = updateProgress;
function updateProgress(event) {
    if (event.lengthComputable) {
      var completedPercent = event.loaded / event.total;
    }
 }

```

### å¦‚ä½•æ‰èƒ½ä¸­æ­¢è¯·æ±‚

xhr.onreadystatechange = function () {}; //æ¸…ç†äº‹ä»¶å“åº”å‡½æ•°
xhr.abort(); //ä¸­æ­¢è¯·æ±‚

åœ¨è°ƒç”¨ abort() æ–¹æ³•å‰ï¼Œåº”å…ˆæ¸…é™¤ onreadystatechange äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå› ä¸º IE å’Œ Mozilla åœ¨è¯·æ±‚ä¸­æ­¢åä¹Ÿä¼šæ¿€æ´»è¿™ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ã€‚å¦‚æœç»™ onreadystatechange å±æ€§è®¾ç½®ä¸º nullï¼Œåˆ™ IE ä¼šå‘ç”Ÿå¼‚å¸¸ï¼Œæ‰€ä»¥ä¸ºå®ƒè®¾ç½®ä¸€ä¸ªç©ºå‡½æ•°ã€‚

### è¯·æ±‚æˆåŠŸçš„å›è°ƒ

å‰é¢å†™è¿‡ï¼Œå°±æ˜¯åœ¨ onreadystatechange åˆ¤æ–­ readyState == 4 ã€‚ã€‚ã€‚ã€‚ã€‚å»ä¸Šé¢çœ‹å“ˆ
å½“ç„¶å•¦ ï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œä¹Ÿæ˜¯æˆ‘æ¯”è¾ƒæ¨èçš„ï¼Œ

```
 xhr.onload = function () {
    //å¦‚æœè¯·æ±‚æˆåŠŸ
    if((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304){
      //do successCallback
    }
  }

```

### æ¯”è¾ƒå®Œæ•´çš„ http è¯·æ±‚ï¼Œæ–¹ä¾¿å¤§å®¶ç”¨çš„æ—¶å€™å¤åˆ¶ç²˜è´´ï¼Œå˜¿å˜¿

```
 let xhr = new XMLHttpRequest();
// è¯·æ±‚æˆåŠŸå›è°ƒå‡½æ•°
xhr.onload = e => {
    console.log('request success');
};
// è¯·æ±‚ç»“æŸ
xhr.onloadend = e => {
    console.log('request loadend');
};
// è¯·æ±‚å‡ºé”™
xhr.onerror = e => {
    console.log('request error');
};
// è¯·æ±‚è¶…æ—¶
xhr.ontimeout = e => {
    console.log('request timeout');
};
// è¯·æ±‚å›è°ƒå‡½æ•°.XMLHttpRequestæ ‡å‡†åˆåˆ†ä¸ºLevel 1å’ŒLevel 2,è¿™æ˜¯Level 1å’Œçš„å›è°ƒå¤„ç†æ–¹å¼
// xhr.onreadystatechange = () => {
//  if (xhr.readyState !== 4) {
//  return;
//  }
//  const status = xhr.status;
//  if ((status >= 200 && status < 300) || status === 304) {
//  console.log('request success');
//  } else {
//  console.log('request error');
//  }
//  };

xhr.timeout = 0; // è®¾ç½®è¶…æ—¶æ—¶é—´,0è¡¨ç¤ºæ°¸ä¸è¶…æ—¶
// åˆå§‹åŒ–è¯·æ±‚
xhr.open('GET/POST/DELETE/...', '/url', true || false);
// è®¾ç½®æœŸæœ›çš„è¿”å›æ•°æ®ç±»å‹ 'json' 'text' 'document' ...
xhr.responseType = '';
// è®¾ç½®è¯·æ±‚å¤´
xhr.setRequestHeader('', '');
// å‘é€è¯·æ±‚
xhr.send(null || new FormData || 'a=1&b=2' || 'jsonå­—ç¬¦ä¸²');
```

## å°è£… XMLHttpRequest

ä¸‹é¢çš„ä»£ç æœ‰ç‚¹å¤šï¼Œä¸çˆ±çœ‹å¯ä»¥ä¸çœ‹ï¼Œæ²¡ä»€ä¹ˆéš¾ç‚¹ã€‚å¤§ä½“æ€è·¯æˆ‘è¿™é‡Œå‘Šè¯‰ä½ ï¼š
å…ˆå†™ä¸€ä¸ªé»˜è®¤çš„è¯·æ±‚éœ€è¦çš„ä¸€äº›å‚æ•°å•¥çš„ï¼Œæ¯”å¦‚é»˜è®¤ get æ–¹æ³•ï¼Œé»˜è®¤å¼‚æ­¥è¯·æ±‚ç­‰ã€‚
å¦‚æœæ˜¯ get è¯·æ±‚ï¼ŒæŠŠè¯·æ±‚å‚æ•°æ”¾è¿› url é‡Œé¢æ ¼å¼ä¸º https://www.wanghaojvlao.com?wanghao=jvlao&wanghao=shadiaoè¿™æ ·
å¦‚æœæ˜¯ postï¼Œè½¬åŒ–è¯·æ±‚ä½“ä¸­çš„ date ç±»å‹ä¸ºå­—ç¬¦ä¸²ç±»å‹
å¤§æ¦‚æ€è·¯å°±æ˜¯è¿™æ ·ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï½

```
const http = {
  /**
   * jså°è£…ajaxè¯·æ±‚
   * >>ä½¿ç”¨new XMLHttpRequest åˆ›å»ºè¯·æ±‚å¯¹è±¡,æ‰€ä»¥ä¸è€ƒè™‘ä½ç«¯IEæµè§ˆå™¨(IE6åŠä»¥ä¸‹ä¸æ”¯æŒXMLHttpRequest)
   * >>ä½¿ç”¨es6è¯­æ³•,å¦‚æœéœ€è¦åœ¨æ­£å¼ç¯å¢ƒä½¿ç”¨,åˆ™å¯ä»¥ç”¨babelè½¬æ¢ä¸ºes5è¯­æ³• https://babeljs.cn/docs/setup/#installation
   *  @param settings è¯·æ±‚å‚æ•°æ¨¡ä»¿jQuery ajax
   *  è°ƒç”¨è¯¥æ–¹æ³•,dataå‚æ•°éœ€è¦å’Œè¯·æ±‚å¤´Content-Typeå¯¹åº”
   *  Content-Type                        data                                     æè¿°
   *  application/x-www-form-urlencoded   'name=å“ˆå“ˆ&age=12'æˆ–{name:'å“ˆå“ˆ',age:12}  æŸ¥è¯¢å­—ç¬¦ä¸²,ç”¨&åˆ†å‰²
   *  application/json                     name=å“ˆå“ˆ&age=12'                        jsonå­—ç¬¦ä¸²
   *  multipart/form-data                  new FormData()                           FormDataå¯¹è±¡,å½“ä¸ºFormDataç±»å‹,ä¸è¦æ‰‹åŠ¨è®¾ç½®Content-Type
   *  æ³¨æ„:è¯·æ±‚å‚æ•°å¦‚æœåŒ…å«æ—¥æœŸç±»å‹.æ˜¯å¦èƒ½è¯·æ±‚æˆåŠŸéœ€è¦åå°æ¥å£é…åˆ
   */
  ajax: (settings = {}) => {
    // åˆå§‹åŒ–è¯·æ±‚å‚æ•°
    let _s = Object.assign({
      url: '', // string
      type: 'GET', // string 'GET' 'POST' 'DELETE'
      dataType: 'json', // string æœŸæœ›çš„è¿”å›æ•°æ®ç±»å‹:'json' 'text' 'document' ...
      async: true, //  boolean true:å¼‚æ­¥è¯·æ±‚ false:åŒæ­¥è¯·æ±‚ required
      data: null, // any è¯·æ±‚å‚æ•°,dataéœ€è¦å’Œè¯·æ±‚å¤´Content-Typeå¯¹åº”
      headers: {}, // object è¯·æ±‚å¤´
      timeout: 1000, // string è¶…æ—¶æ—¶é—´:0è¡¨ç¤ºä¸è®¾ç½®è¶…æ—¶
      beforeSend: (xhr) => {
      },
      success: (result, status, xhr) => {
      },
      error: (xhr, status, error) => {
      },
      complete: (xhr, status) => {
      }
    }, settings);
    // å‚æ•°éªŒè¯
    if (!_s.url || !_s.type || !_s.dataType || !_s.async) {
      alert('å‚æ•°æœ‰è¯¯');
      return;
    }
    // åˆ›å»ºXMLHttpRequestè¯·æ±‚å¯¹è±¡
    let xhr = new XMLHttpRequest();
    // è¯·æ±‚å¼€å§‹å›è°ƒå‡½æ•°
    xhr.addEventListener('loadstart', e => {
      _s.beforeSend(xhr);
    });
    // è¯·æ±‚æˆåŠŸå›è°ƒå‡½æ•°
    xhr.addEventListener('load', e => {
      const status = xhr.status;
      if ((status >= 200 && status < 300) || status === 304) {
        let result;
        if (xhr.responseType === 'text') {
          result = xhr.responseText;
        } else if (xhr.responseType === 'document') {
          result = xhr.responseXML;
        } else {
          result = xhr.response;
        }
        // æ³¨æ„:çŠ¶æ€ç 200è¡¨ç¤ºè¯·æ±‚å‘é€/æ¥å—æˆåŠŸ,ä¸è¡¨ç¤ºä¸šåŠ¡å¤„ç†æˆåŠŸ
        _s.success(result, status, xhr);
      } else {
        _s.error(xhr, status, e);
      }
    });
    // è¯·æ±‚ç»“æŸ
    xhr.addEventListener('loadend', e => {
      _s.complete(xhr, xhr.status);
    });
    // è¯·æ±‚å‡ºé”™
    xhr.addEventListener('error', e => {
      _s.error(xhr, xhr.status, e);
    });
    // è¯·æ±‚è¶…æ—¶
    xhr.addEventListener('timeout', e => {
      _s.error(xhr, 408, e);
    });
    let useUrlParam = false;
    let sType = _s.type.toUpperCase();
    // å¦‚æœæ˜¯"ç®€å•"è¯·æ±‚,åˆ™æŠŠdataå‚æ•°ç»„è£…åœ¨urlä¸Š
    if (sType === 'GET' || sType === 'DELETE') {
      useUrlParam = true;
      _s.url += http.getUrlParam(_s.url, _s.data);
    }
    // åˆå§‹åŒ–è¯·æ±‚

    xhr.open(_s.type, _s.url, _s.async);
    // è®¾ç½®æœŸæœ›çš„è¿”å›æ•°æ®ç±»å‹
    xhr.responseType = _s.dataType;
    // è®¾ç½®è¯·æ±‚å¤´
    for (const key of Object.keys(_s.headers)) {
      xhr.setRequestHeader(key, _s.headers[key]);
    }
    // è®¾ç½®è¶…æ—¶æ—¶é—´
    if (_s.async && _s.timeout) {
      xhr.timeout = _s.timeout;
    }
    // å‘é€è¯·æ±‚.å¦‚æœæ˜¯ç®€å•è¯·æ±‚,è¯·æ±‚å‚æ•°åº”ä¸ºnull.å¦åˆ™,è¯·æ±‚å‚æ•°ç±»å‹éœ€è¦å’Œè¯·æ±‚å¤´Content-Typeå¯¹åº”
    xhr.send(useUrlParam ? null : http.getQueryData(_s.data));
  },
  // æŠŠå‚æ•°dataè½¬ä¸ºurlæŸ¥è¯¢å‚æ•°
  getUrlParam: (url, data) => {
    if (!data) {
      return '';
    }
    let paramsStr = data instanceof Object ? http.getQueryString(data) : data;
    return (url.indexOf('?') !== -1) ? paramsStr : '?' + paramsStr;
  },
  // è·å–ajaxè¯·æ±‚å‚æ•°
  getQueryData: (data) => {
    if (!data) {
      return null;
    }
    if (typeof data === 'string') {
      return data;
    }
    if (data instanceof FormData) {
      return data;
    }
    return http.getQueryString(data);
  },
  // æŠŠå¯¹è±¡è½¬ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²
  getQueryString: (data) => {
    let paramsArr = [];
    if (data instanceof Object) {
      Object.keys(data).forEach(key => {
        let val = data[key];
        // todo å‚æ•°Dateç±»å‹éœ€è¦æ ¹æ®åå°apié…Œæƒ…å¤„ç†
        if (val instanceof Date) {
          // val = dateFormat(val, 'yyyy-MM-dd hh:mm:ss');
        }
        paramsArr.push(encodeURIComponent(key) + '=' + encodeURIComponent(val));
      });
    }
    return paramsArr.join('&');
  }
}
```

è¿™æ—¶å€™è°ƒç”¨çš„ä»£ç åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

```
http.ajax({
  url: url,
  type: 'POST',
  data: {name: 'å“ˆå“ˆ', age: 12}, //æˆ– data: 'name=å“ˆå“ˆ&age=12',
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
  },
  beforeSend: (xhr) => {
    console.log('request show loading...');
  },
  success: function (result, status, xhr) {
    console.log('request success...');
  },
  error: (xhr, status, error) => {
    console.log('request error...');
  },
  complete: (xhr, status) => {
    console.log('request hide loading...');
  }
});
```

å¯ä»¥çœ‹å‡ºæ¥å“ˆï¼Œè¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œä½ æ€»ä¸èƒ½æ¯æ¬¡è¯·æ±‚éƒ½æ•´çœŸä¹ˆä¸€å¤§å †ä»£ç å§ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­å°è£…ï¼

```
const http = {
  /**
   * æ ¹æ®å®é™…ä¸šåŠ¡æƒ…å†µè£…é¥° ajax æ–¹æ³•
   * å¦‚:ç»Ÿä¸€å¼‚å¸¸å¤„ç†,æ·»åŠ httpè¯·æ±‚å¤´,è¯·æ±‚å±•ç¤ºloadingç­‰
   * @param settings
   */
  request: (settings = {}) => {
    // ç»Ÿä¸€å¼‚å¸¸å¤„ç†å‡½æ•°
    let errorHandle = (xhr, status) => {
      console.log('request error...');
      if (status === 401) {
        console.log('request æ²¡æœ‰æƒé™...');
      }
      if (status === 408) {
        console.log('request timeout');
      }
    };
    // ä½¿ç”¨beforeæ‹¦æˆªå‚æ•°çš„ beforeSend å›è°ƒå‡½æ•°
    settings.beforeSend = (settings.beforeSend || function () {
    }).before(xhr => {
      console.log('request show loading...');
    });
    // ä¿å­˜å‚æ•°successå›è°ƒå‡½æ•°
    let successFn = settings.success;
    // è¦†ç›–å‚æ•°successå›è°ƒå‡½æ•°
    settings.success = (result, status, xhr) => {
      // todo æ ¹æ®åå°apiåˆ¤æ–­æ˜¯å¦è¯·æ±‚æˆåŠŸ
      if (result && result instanceof Object && result.code !== 1) {
        errorHandle(xhr, status);
      } else {
        console.log('request success');
        successFn && successFn(result, status, xhr);
      }
    };
    // æ‹¦æˆªå‚æ•°çš„ error
    settings.error = (settings.error || function () {
    }).before((result, status, xhr) => {
      errorHandle(xhr, status);
    });
    // æ‹¦æˆªå‚æ•°çš„ complete
    settings.complete = (settings.complete || function () {
    }).after((xhr, status) => {
      console.log('request hide loading...');
    });
    // è¯·æ±‚æ·»åŠ æƒé™å¤´,ç„¶åè°ƒç”¨http.ajaxæ–¹æ³•
    (http.ajax.before(http.addAuthorizationHeader))(settings);
  },
  // æ·»åŠ æƒé™è¯·æ±‚å¤´
  addAuthorizationHeader: (settings) => {
    settings.headers = settings.headers || {};
    const headerKey = 'Authorization'; // todo æƒé™å¤´åç§°
    // åˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨æƒé™header
    let hasAuthorization = Object.keys(settings.headers).some(key => {
      return key === headerKey;
    });
    if (!hasAuthorization) {
      settings.headers[headerKey] = 'test'; // todo ä»ç¼“å­˜ä¸­è·å–headerKeyçš„å€¼
    }
  }
};

Function.prototype.before = function (beforeFn) { // eslint-disable-line
  let _self = this;
  return function () {
    beforeFn.apply(this, arguments);
    _self.apply(this, arguments);
  };
};

Function.prototype.after = function (afterFn) { // eslint-disable-line
  let _self = this;
  return function () {
    _self.apply(this, arguments);
    afterFn.apply(this, arguments);
  };
};
```

å¥½æäº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬è°ƒç”¨çš„ä»£ç æ›´ç®€æ´äº›äº†ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š

```
http.request({
  url: url,
  type: 'POST',
  data: {name: 'å“ˆå“ˆ', age: 12}, // data: 'name=å“ˆå“ˆ&age=12',
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
  },
  success: function (result, status, xhr) {
    console.log('è¿›è¡Œä¸šåŠ¡æ“ä½œ');
  }
});




//å¯¹æ¯”ä¸‹åˆšåˆšçš„
http.ajax({
  url: url,
  type: 'POST',
  data: {name: 'å“ˆå“ˆ', age: 12}, //æˆ– data: 'name=å“ˆå“ˆ&age=12',
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
  },
  beforeSend: (xhr) => {
    console.log('request show loading...');
  },
  success: function (result, status, xhr) {
    console.log('request success...');
  },
  error: (xhr, status, error) => {
    console.log('request error...');
  },
  complete: (xhr, status) => {
    console.log('request hide loading...');
  }
});
```

å˜¿å˜¿ï¼Œä¸è¦åœï¼Œè®©æˆ‘ä»¬ç»§ç»­å°è£…ä¸€ä¸‹ï½ ğŸ˜

```
const http = {
  get: (url, data, successCallback, dataType = 'json') => {
    http.request({
      url: url,
      type: 'GET',
      dataType: dataType,
      data: data,
      success: successCallback
    });
  },
  delete: (url, data, successCallback, dataType = 'json') => {
    http.request({
      url: url,
      type: 'DELETE',
      dataType: dataType,
      data: data,
      success: successCallback
    });
  },
  // è°ƒç”¨æ­¤æ–¹æ³•,å‚æ•°dataåº”ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²æˆ–æ™®é€šå¯¹è±¡
  post: (url, data, successCallback, dataType = 'json') => {
    http.request({
      url: url,
      type: 'POST',
      dataType: dataType,
      data: data,
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
      },
      success: successCallback
    });
  },
  // è°ƒç”¨æ­¤æ–¹æ³•,å‚æ•°dataåº”ä¸ºjsonå­—ç¬¦ä¸²
  postBody: (url, data, successCallback, dataType = 'json') => {
    http.request({
      url: url,
      type: 'POST',
      dataType: dataType,
      data: data,
      headers: {
        'Content-Type': 'application/json; charset=UTF-8'
      },
      success: successCallback
    });
  }
};

```

æ­¤æ—¶ï¼Œæ­¤æ—¶æ­¤åˆ»ï¼Œright now ï¼ let us see see ğŸ˜‚

```
http.get(url + '?name=å“ˆå“ˆ&age=12', null, (result, status, xhr) => {
  console.log('è¿›è¡Œä¸šåŠ¡æ“ä½œ');
});

```
