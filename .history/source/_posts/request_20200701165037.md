---
title: ä»XMLHttpRequeståˆ°jqè¯·æ±‚å†åˆ°axios
date: 2020-07-01 11:22:06
tags: XMLHttpRequest jq.request axios
---

XMLHttpRequestï¼ˆXHRï¼‰å¯¹è±¡ç”¨äºä¸æœåŠ¡å™¨äº¤äº’ã€‚é€šè¿‡ XMLHttpRequest å¯ä»¥åœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹è¯·æ±‚ç‰¹å®š URLï¼Œè·å–æ•°æ®ã€‚è¿™å…è®¸ç½‘é¡µåœ¨ä¸å½±å“ç”¨æˆ·æ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ›´æ–°é¡µé¢çš„å±€éƒ¨å†…å®¹ã€‚XMLHttpRequest åœ¨ AJAX ç¼–ç¨‹ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚

### XMLHttpRequest

å’±ä»¬ç¡¬æ ¸ä¸€ç‚¹ï¼Œç›´æ¥ä¸Šä»£ç 

#### ç®€å•ä¾‹å­ ğŸŒ°

```
let xhr = new XMLHttpRequest();
xhr.open('GET','https://www.baidu.com',true,username,password);
 // è§£é‡Šä¸€ä¸‹å‚æ•°ã€‚GETé‡Šè¯·æ±‚æ–¹æ³•ï¼Œå¿…é¡»å¾—æœ‰ï¼Œhttpè¯·æ±‚æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå¸¸ç”¨post/get ï¼Œè¿™é‡Œçš„å‚æ•°å†™æ³•ä¸åŒºåˆ†å¤§å°å†™ï¼Œå†™æˆâ€˜getâ€™ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚
 // ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¯·æ±‚çš„urlï¼Œå¿…é¡»å¾—æœ‰ã€‚
 // ç¬¬ä¸‰ä¸ªå‚æ•°è¿™é‡Œçš„true ä»£è¡¨æ˜¯å¦å¼‚æ­¥ ï¼Œå¦‚æœæ˜¯trueå°±å¼‚æ­¥ï¼Œfalseå°±åŒæ­¥ ã€‚é»˜è®¤ä¸ºå¼‚æ­¥ã€‚
 // usernameï¼šå¯é€‰å‚æ•°ï¼Œå¦‚æœæœåŠ¡å™¨éœ€è¦éªŒè¯ï¼Œè¯¥å‚æ•°æŒ‡å®šç”¨æˆ·åï¼Œå¦‚æœæœªæŒ‡å®šï¼Œå½“æœåŠ¡å™¨éœ€è¦éªŒè¯æ—¶ï¼Œä¼šå¼¹å‡ºéªŒè¯çª—å£ã€‚
 // passwordï¼šå¯é€‰å‚æ•°ï¼ŒéªŒè¯ä¿¡æ¯ä¸­çš„å¯†ç éƒ¨åˆ†ï¼Œå¦‚æœç”¨æˆ·åä¸ºç©ºï¼Œåˆ™è¯¥å€¼å°†è¢«å¿½ç•¥ã€‚
xhr.send(body)
 // bodyæ˜¯é€šè¿‡è¯¥è¯·æ±‚å‘é€çš„å‚æ•°æ•°æ®å•¥çš„ï¼Œä¸ä¼ å°±ä¸ç”¨å¡«å†™ã€‚

```

è¿™é‡Œæ’æ’­ä¸€ä¸‹è¯·æ±‚å¤±è´¥çš„é”™è¯¯ç ï¼Œæƒ³äº†ä¸€ä¸‹ï¼Œè¿˜æ˜¯æ”¾åœ¨è¿™ç¯‡æ–‡é‡Œè¾¹å§ï¼Œåæ­£å‘è¯·æ±‚å°±ä¼šæœ‰è¯·æ±‚å¤±è´¥çš„å¯èƒ½å˜›ã€‚
1xxï¼šæŒ‡ç¤ºä¿¡æ¯--è¡¨ç¤ºè¯·æ±‚å·²æ¥æ”¶ï¼Œç»§ç»­å¤„ç†ã€‚
2xxï¼šæˆåŠŸ--è¡¨ç¤ºè¯·æ±‚å·²è¢«æˆåŠŸæ¥æ”¶ã€ç†è§£ã€æ¥å—ã€‚
3xxï¼šé‡å®šå‘--è¦å®Œæˆè¯·æ±‚å¿…é¡»è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„æ“ä½œã€‚
4xxï¼šå®¢æˆ·ç«¯é”™è¯¯--è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯æˆ–è¯·æ±‚æ— æ³•å®ç°ã€‚
5xxï¼šæœåŠ¡å™¨ç«¯é”™è¯¯--æœåŠ¡å™¨æœªèƒ½å®ç°åˆæ³•çš„è¯·æ±‚ã€‚å¸¸è§çŠ¶æ€ä»£ç ã€çŠ¶æ€æè¿°çš„è¯´æ˜å¦‚ä¸‹ã€‚
200 OKï¼šå®¢æˆ·ç«¯è¯·æ±‚æˆåŠŸã€‚
400 Bad Requestï¼šå®¢æˆ·ç«¯è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯ï¼Œä¸èƒ½è¢«æœåŠ¡å™¨æ‰€ç†è§£ã€‚
401 Unauthorizedï¼šè¯·æ±‚æœªç»æˆæƒï¼Œè¿™ä¸ªçŠ¶æ€ä»£ç å¿…é¡»å’Œ WWW-Authenticate æŠ¥å¤´åŸŸä¸€èµ·ä½¿ç”¨ã€‚
403 Forbiddenï¼šæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æä¾›æœåŠ¡ã€‚
404 Not Foundï¼šè¯·æ±‚èµ„æºä¸å­˜åœ¨ï¼Œä¸¾ä¸ªä¾‹å­ï¼šè¾“å…¥äº†é”™è¯¯çš„ URLã€‚
500 Internal Server Errorï¼šæœåŠ¡å™¨å‘ç”Ÿä¸å¯é¢„æœŸçš„é”™è¯¯ã€‚
503 Server Unavailableï¼šæœåŠ¡å™¨å½“å‰ä¸èƒ½å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¸€æ®µæ—¶é—´åå¯èƒ½æ¢å¤æ­£å¸¸ï¼Œä¸¾ä¸ªä¾‹å­ï¼šHTTP/1.1 200 OKï¼ˆCRLFï¼‰ã€‚

**é€šå¸¸æŠ¥ 400 å¤šçš„æ—¶å€™ï¼Œå’±ä»¬å‰ç«¯å°±å·å·è‡ªå·±æ‰¾æ‰¾åŸå› ï¼ŒæŠ¥ 500 å¤šçš„æ—¶å€™ï¼Œç›´æ¥æ‰¾åç«¯å°±è¡Œã€‚**

ä¸Šè¾¹æ˜¯ä¸ªç®€å•çš„æ —å­ ğŸŒ°ï¼Œè®©æˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹çš„å¾€ä¸ŠåŠ ä¸œè¥¿ï½

### onreadystatechange

```
let xhr = new XMLHttpRequest();
xhr.open('GET','https://www.baidu.com',true,username,password);

xhr.onreadystatechange = function(e){
  if(this.readyState === 4 && this.status === '200'){
    // è¿™é‡Œthiså°±æ˜¯xhr this.readyState å°±æ˜¯ xhr.readyState
    do something
  }
}

xhr.send(body)


```

è¿™ä¸ªæ —å­é‡Œ xhr å¤šäº†ä¸€ä¸ªå±æ€§ onreadystatechange ã€‚onreadystatechange æ˜¯ä¸€ä¸ªäº‹ä»¶å¥æŸ„ã€‚åè¾¹æ˜¯äº‹ä»¶è§¦å‘çš„å›è°ƒå‡½æ•°ã€‚å½“ XMLHttpRequest å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šè§¦å‘æ­¤å‡½æ•°ã€‚çŠ¶æ€ä» 0 (uninitialized) åˆ° 4 (complete) è¿›è¡Œå˜åŒ–ã€‚ä»…åœ¨çŠ¶æ€ä¸º 4 æ—¶ï¼Œæˆ‘ä»¬æ‰æ‰§è¡Œä»£ç ã€‚

_è¡¥å……ä¸€ä¸‹ readyState çš„çŸ¥è¯†ï¼Œçœ‹çœ‹çŸ¥é“æœ‰è¿™ä¹ˆä¸ªäº‹å°±è¡Œã€‚_
_0 æœªåˆå§‹åŒ–ã€‚è¡¨ç¤ºå¯¹è±¡å·²ç»å»ºç«‹ï¼Œä½†æ˜¯å°šæœªåˆå§‹åŒ–ï¼Œå°šæœªè°ƒç”¨ open() æ–¹æ³•_
_1 åˆå§‹åŒ–ã€‚è¡¨ç¤ºå¯¹è±¡å·²ç»å»ºç«‹ï¼Œå°šæœªè°ƒç”¨ send() æ–¹æ³•_
_2 å‘é€æ•°æ®ã€‚è¡¨ç¤º send() æ–¹æ³•å·²ç»è°ƒç”¨ï¼Œä½†æ˜¯å½“å‰çš„çŠ¶æ€åŠ HTTP å¤´æœªçŸ¥_
_3 æ•°æ®ä¼ é€ä¸­ã€‚å·²ç»æ¥æ”¶éƒ¨åˆ†æ•°æ®ï¼Œå› ä¸ºå“åº”åŠ HTTP å¤´ä¸å®‰å…¨ï¼Œè¿™æ—¶é€šè¿‡ responseBody å’Œ responseText è·å–éƒ¨åˆ†æ•°æ®ä¼šå‡ºç°é”™è¯¯_
_4 å®Œæˆã€‚æ•°æ®æ¥æ”¶å®Œæ¯•ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡ responseBody å’Œ responseText è·å–å®Œæ•´çš„å“åº”æ•°æ®_

### å¦‚ä½•è®¾ç½® request header

setRequestHeader(name, value)

name å‚æ•°æ˜¯è¦è®¾ç½®çš„å¤´éƒ¨çš„åç§°ã€‚è¿™ä¸ªå‚æ•°ä¸åº”è¯¥åŒ…æ‹¬ç©ºç™½ã€å†’å·æˆ–æ¢è¡Œã€‚
value å‚æ•°æ˜¯å¤´éƒ¨çš„å€¼ã€‚è¿™ä¸ªå‚æ•°ä¸åº”è¯¥åŒ…æ‹¬æ¢è¡Œã€‚

```
let xhr = new XMLHttpRequest();
xhr.open('GET','https://www.baidu.com',true,username,password);


xhr.setRequestHeader('Content-Type', 'one');
xhr.setRequestHeader('Content-Type', 'two');
// æœ€ç»ˆrequest headerä¸­"Content-Type"ä¸º: one, two

xhr.send(body)


```

æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•° header å¤§å°å†™ä¸æ•æ„Ÿï¼Œå³å¯ä»¥å†™æˆ content-typeï¼Œä¹Ÿå¯ä»¥å†™æˆ Content-Typeï¼Œç”šè‡³å†™æˆ content-Typeã€‚

Content-Type çš„é»˜è®¤å€¼ä¸å…·ä½“å‘é€çš„æ•°æ®ç±»å‹æœ‰å…³ã€‚

setRequestHeader å¿…é¡»åœ¨ open()æ–¹æ³•ä¹‹åï¼Œsend()æ–¹æ³•ä¹‹å‰è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ›é”™ã€‚

setRequestHeader å¯ä»¥è°ƒç”¨å¤šæ¬¡ï¼Œæœ€ç»ˆçš„å€¼ä¸ä¼šé‡‡ç”¨è¦†ç›– override çš„æ–¹å¼ï¼Œè€Œæ˜¯é‡‡ç”¨è¿½åŠ  append çš„æ–¹å¼ã€‚

### å¦‚ä½•æŒ‡å®š xhr.response çš„æ•°æ®ç±»å‹

xhr.overrideMimeType('text/plain; charset=utf-8') // xhr level 1 ä½¿ç”¨çš„æ–¹æ³•ã€‚

xhr.responseType = 'blob' // xhr level 2 å¯ä»¥ç”¨çš„ï¼Œæ¯”ä¸Šé¢ç®€å•å¾ˆå¤šï¼Œä½†æ˜¯è¯´æ˜¯å…¼å®¹æ€§ç¨å¾®å·®ä¸€ç‚¹ç‚¹ã€‚ä¸è¿‡æˆ‘æ²¡å‘ç°è¿‡ä»»ä½•é—®é¢˜ï¼Œæ¨èç”¨ä¸‹è¾¹çš„å†™æ³•

### å¦‚ä½•è®¾ç½®è¯·æ±‚çš„è¶…æ—¶æ—¶é—´

å¦‚æœè¯·æ±‚è¿‡äº†å¾ˆä¹…è¿˜æ²¡æœ‰æˆåŠŸï¼Œä¸ºäº†ä¸ä¼šç™½ç™½å ç”¨çš„ç½‘ç»œèµ„æºï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä¸»åŠ¨ç»ˆæ­¢è¯·æ±‚ã€‚XMLHttpRequest æä¾›äº† timeout å±æ€§æ¥å…è®¸è®¾ç½®è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ã€‚
xhr.timeout = 0
å•ä½ï¼šmilliseconds æ¯«ç§’
é»˜è®¤å€¼ï¼š0ï¼Œå³ä¸è®¾ç½®è¶…æ—¶

âš ï¸ æ³¨æ„ï¼š**å½“ xhr ä¸ºä¸€ä¸ª sync åŒæ­¥è¯·æ±‚æ—¶**ï¼Œxhr.timeout å¿…é¡»ç½®ä¸º 0ï¼Œå¦åˆ™ä¼šæŠ›é”™ã€‚å¹¶ä¸” xhr.withCredentials å¿…é¡»ä¸º false

xhr.responseType å¿…é¡»ä¸º""ï¼ˆæ³¨æ„ç½®ä¸º"text"ä¹Ÿä¸å…è®¸ï¼‰

### å¦‚ä½•è·å–ä¸Šä¼ ã€ä¸‹è½½çš„è¿›åº¦

åœ¨ä¸Šä¼ æˆ–è€…ä¸‹è½½æ¯”è¾ƒå¤§çš„æ–‡ä»¶æ—¶ï¼Œå®æ—¶æ˜¾ç¤ºå½“å‰çš„ä¸Šä¼ ã€ä¸‹è½½è¿›åº¦æ˜¯å¾ˆæ™®éçš„äº§å“éœ€æ±‚ã€‚
æˆ‘ä»¬å¯ä»¥é€šè¿‡ onprogress äº‹ä»¶æ¥å®æ—¶æ˜¾ç¤ºè¿›åº¦ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªäº‹ä»¶æ¯ 50ms è§¦å‘ä¸€æ¬¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šä¼ è¿‡ç¨‹å’Œä¸‹è½½è¿‡ç¨‹è§¦å‘çš„æ˜¯ä¸åŒå¯¹è±¡çš„ onprogress äº‹ä»¶ï¼š

ä¸Šä¼ è§¦å‘çš„æ˜¯ xhr.upload å¯¹è±¡çš„ onprogress äº‹ä»¶

ä¸‹è½½è§¦å‘çš„æ˜¯ xhr å¯¹è±¡çš„ onprogress äº‹ä»¶

```

xhr.onprogress = updateProgress;
xhr.upload.onprogress = updateProgress;
function updateProgress(event) {
    if (event.lengthComputable) {
      var completedPercent = event.loaded / event.total;
    }
 }

```

### è¯·æ±‚æˆåŠŸçš„å›è°ƒ

å‰é¢å†™è¿‡ï¼Œå°±æ˜¯åœ¨ onreadystatechange åˆ¤æ–­ readyState == 4 ã€‚ã€‚ã€‚ã€‚ã€‚å»ä¸Šé¢çœ‹å“ˆ
å½“ç„¶å•¦ ï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œä¹Ÿæ˜¯æˆ‘æ¯”è¾ƒæ¨èçš„ï¼Œ

```
 xhr.onload = function () {
    //å¦‚æœè¯·æ±‚æˆåŠŸ
    if((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304){
      //do successCallback
    }
  }

```
