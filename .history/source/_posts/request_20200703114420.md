---
title: httpè¯·æ±‚æ–¹æ–¹é¢é¢å®‰æ’ä¸€æ³¢
date: 2020-07-01 11:22:06
tags: XMLHttpRequest request axios
---

å‰è¨€ï¼šä¸‹è¾¹çš„å†…å®¹æ˜¯ä» XMLHttpRequestï¼Œåˆ°å°è£… XMLHttpRequestï¼Œå†åˆ° axiosã€‚å†™äº†å¾ˆå¤šï¼Œæ…¢æ…¢çœ‹ï½

## -XMLHttpRequest

XMLHttpRequestï¼ˆXHRï¼‰å¯¹è±¡ç”¨äºä¸æœåŠ¡å™¨äº¤äº’ã€‚é€šè¿‡ XMLHttpRequest å¯ä»¥åœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹è¯·æ±‚ç‰¹å®š URLï¼Œè·å–æ•°æ®ã€‚è¿™å…è®¸ç½‘é¡µåœ¨ä¸å½±å“ç”¨æˆ·æ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ›´æ–°é¡µé¢çš„å±€éƒ¨å†…å®¹ã€‚XMLHttpRequest åœ¨ AJAX ç¼–ç¨‹ä¸­è¢«å¤§é‡ä½¿ç”¨ã€‚
å’±ä»¬ç¡¬æ ¸ä¸€ç‚¹ï¼Œç›´æ¥ä¸Šä»£ç 

#### ç®€å•ä¾‹å­ ğŸŒ°

```
let xhr = new XMLHttpRequest();
xhr.open('GET','https://www.baidu.com',true,username,password);
 // è§£é‡Šä¸€ä¸‹å‚æ•°ã€‚GETé‡Šè¯·æ±‚æ–¹æ³•ï¼Œå¿…é¡»å¾—æœ‰ï¼Œhttpè¯·æ±‚æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå¸¸ç”¨post/get ï¼Œè¿™é‡Œçš„å‚æ•°å†™æ³•ä¸åŒºåˆ†å¤§å°å†™ï¼Œå†™æˆâ€˜getâ€™ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚
 // ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¯·æ±‚çš„urlï¼Œå¿…é¡»å¾—æœ‰ã€‚
 // ç¬¬ä¸‰ä¸ªå‚æ•°è¿™é‡Œçš„true ä»£è¡¨æ˜¯å¦å¼‚æ­¥ ï¼Œå¦‚æœæ˜¯trueå°±å¼‚æ­¥ï¼Œfalseå°±åŒæ­¥ ã€‚é»˜è®¤ä¸ºå¼‚æ­¥ã€‚
 // usernameï¼šå¯é€‰å‚æ•°ï¼Œå¦‚æœæœåŠ¡å™¨éœ€è¦éªŒè¯ï¼Œè¯¥å‚æ•°æŒ‡å®šç”¨æˆ·åï¼Œå¦‚æœæœªæŒ‡å®šï¼Œå½“æœåŠ¡å™¨éœ€è¦éªŒè¯æ—¶ï¼Œä¼šå¼¹å‡ºéªŒè¯çª—å£ã€‚
 // passwordï¼šå¯é€‰å‚æ•°ï¼ŒéªŒè¯ä¿¡æ¯ä¸­çš„å¯†ç éƒ¨åˆ†ï¼Œå¦‚æœç”¨æˆ·åä¸ºç©ºï¼Œåˆ™è¯¥å€¼å°†è¢«å¿½ç•¥ã€‚
xhr.send(body)
 // bodyæ˜¯é€šè¿‡è¯¥è¯·æ±‚å‘é€çš„å‚æ•°æ•°æ®å•¥çš„ï¼Œä¸ä¼ å°±ä¸ç”¨å¡«å†™ã€‚

```

è¿™é‡Œæ’æ’­ä¸€ä¸‹è¯·æ±‚å¤±è´¥çš„é”™è¯¯ç ï¼Œæƒ³äº†ä¸€ä¸‹ï¼Œè¿˜æ˜¯æ”¾åœ¨è¿™ç¯‡æ–‡é‡Œè¾¹å§ï¼Œåæ­£å‘è¯·æ±‚å°±ä¼šæœ‰è¯·æ±‚å¤±è´¥çš„å¯èƒ½å˜›ã€‚
1xxï¼šæŒ‡ç¤ºä¿¡æ¯--è¡¨ç¤ºè¯·æ±‚å·²æ¥æ”¶ï¼Œç»§ç»­å¤„ç†ã€‚
2xxï¼šæˆåŠŸ--è¡¨ç¤ºè¯·æ±‚å·²è¢«æˆåŠŸæ¥æ”¶ã€ç†è§£ã€æ¥å—ã€‚
3xxï¼šé‡å®šå‘--è¦å®Œæˆè¯·æ±‚å¿…é¡»è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„æ“ä½œã€‚
4xxï¼šå®¢æˆ·ç«¯é”™è¯¯--è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯æˆ–è¯·æ±‚æ— æ³•å®ç°ã€‚
5xxï¼šæœåŠ¡å™¨ç«¯é”™è¯¯--æœåŠ¡å™¨æœªèƒ½å®ç°åˆæ³•çš„è¯·æ±‚ã€‚å¸¸è§çŠ¶æ€ä»£ç ã€çŠ¶æ€æè¿°çš„è¯´æ˜å¦‚ä¸‹ã€‚
200 OKï¼šå®¢æˆ·ç«¯è¯·æ±‚æˆåŠŸã€‚
400 Bad Requestï¼šå®¢æˆ·ç«¯è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯ï¼Œä¸èƒ½è¢«æœåŠ¡å™¨æ‰€ç†è§£ã€‚
401 Unauthorizedï¼šè¯·æ±‚æœªç»æˆæƒï¼Œè¿™ä¸ªçŠ¶æ€ä»£ç å¿…é¡»å’Œ WWW-Authenticate æŠ¥å¤´åŸŸä¸€èµ·ä½¿ç”¨ã€‚
403 Forbiddenï¼šæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æä¾›æœåŠ¡ã€‚
404 Not Foundï¼šè¯·æ±‚èµ„æºä¸å­˜åœ¨ï¼Œä¸¾ä¸ªä¾‹å­ï¼šè¾“å…¥äº†é”™è¯¯çš„ URLã€‚
500 Internal Server Errorï¼šæœåŠ¡å™¨å‘ç”Ÿä¸å¯é¢„æœŸçš„é”™è¯¯ã€‚
503 Server Unavailableï¼šæœåŠ¡å™¨å½“å‰ä¸èƒ½å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¸€æ®µæ—¶é—´åå¯èƒ½æ¢å¤æ­£å¸¸ï¼Œä¸¾ä¸ªä¾‹å­ï¼šHTTP/1.1 200 OKï¼ˆCRLFï¼‰ã€‚

**é€šå¸¸æŠ¥ 400 å¤šçš„æ—¶å€™ï¼Œå’±ä»¬å‰ç«¯å°±å·å·è‡ªå·±æ‰¾æ‰¾åŸå› ï¼ŒæŠ¥ 500 å¤šçš„æ—¶å€™ï¼Œç›´æ¥æ‰¾åç«¯å°±è¡Œã€‚**

ä¸Šè¾¹æ˜¯ä¸ªç®€å•çš„æ —å­ ğŸŒ°ï¼Œè®©æˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹çš„å¾€ä¸ŠåŠ ä¸œè¥¿ï½

### onreadystatechange

```
let xhr = new XMLHttpRequest();
xhr.open('GET','https://www.baidu.com',true,username,password);

xhr.onreadystatechange = function(e){
  if(this.readyState === 4 && this.status === '200'){
    // è¿™é‡Œthiså°±æ˜¯xhr this.readyState å°±æ˜¯ xhr.readyState
    do something
  }
}

xhr.send(body)


```

è¿™ä¸ªæ —å­é‡Œ xhr å¤šäº†ä¸€ä¸ªå±æ€§ onreadystatechange ã€‚onreadystatechange æ˜¯ä¸€ä¸ªäº‹ä»¶å¥æŸ„ã€‚åè¾¹æ˜¯äº‹ä»¶è§¦å‘çš„å›è°ƒå‡½æ•°ã€‚å½“ XMLHttpRequest å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šè§¦å‘æ­¤å‡½æ•°ã€‚çŠ¶æ€ä» 0 (uninitialized) åˆ° 4 (complete) è¿›è¡Œå˜åŒ–ã€‚ä»…åœ¨çŠ¶æ€ä¸º 4 æ—¶ï¼Œæˆ‘ä»¬æ‰æ‰§è¡Œä»£ç ã€‚

_è¡¥å……ä¸€ä¸‹ readyState çš„çŸ¥è¯†ï¼Œçœ‹çœ‹çŸ¥é“æœ‰è¿™ä¹ˆä¸ªäº‹å°±è¡Œã€‚_
_0 æœªåˆå§‹åŒ–ã€‚è¡¨ç¤ºå¯¹è±¡å·²ç»å»ºç«‹ï¼Œä½†æ˜¯å°šæœªåˆå§‹åŒ–ï¼Œå°šæœªè°ƒç”¨ open() æ–¹æ³•_
_1 åˆå§‹åŒ–ã€‚è¡¨ç¤ºå¯¹è±¡å·²ç»å»ºç«‹ï¼Œå°šæœªè°ƒç”¨ send() æ–¹æ³•_
_2 å‘é€æ•°æ®ã€‚è¡¨ç¤º send() æ–¹æ³•å·²ç»è°ƒç”¨ï¼Œä½†æ˜¯å½“å‰çš„çŠ¶æ€åŠ HTTP å¤´æœªçŸ¥_
_3 æ•°æ®ä¼ é€ä¸­ã€‚å·²ç»æ¥æ”¶éƒ¨åˆ†æ•°æ®ï¼Œå› ä¸ºå“åº”åŠ HTTP å¤´ä¸å®‰å…¨ï¼Œè¿™æ—¶é€šè¿‡ responseBody å’Œ responseText è·å–éƒ¨åˆ†æ•°æ®ä¼šå‡ºç°é”™è¯¯_
_4 å®Œæˆã€‚æ•°æ®æ¥æ”¶å®Œæ¯•ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡ responseBody å’Œ responseText è·å–å®Œæ•´çš„å“åº”æ•°æ®_

### å¦‚ä½•è®¾ç½® request header

setRequestHeader(name, value)

name å‚æ•°æ˜¯è¦è®¾ç½®çš„å¤´éƒ¨çš„åç§°ã€‚è¿™ä¸ªå‚æ•°ä¸åº”è¯¥åŒ…æ‹¬ç©ºç™½ã€å†’å·æˆ–æ¢è¡Œã€‚
value å‚æ•°æ˜¯å¤´éƒ¨çš„å€¼ã€‚è¿™ä¸ªå‚æ•°ä¸åº”è¯¥åŒ…æ‹¬æ¢è¡Œã€‚

```
let xhr = new XMLHttpRequest();
xhr.open('GET','https://www.baidu.com',true,username,password);


xhr.setRequestHeader('Content-Type', 'one');
xhr.setRequestHeader('Content-Type', 'two');
// æœ€ç»ˆrequest headerä¸­"Content-Type"ä¸º: one, two

xhr.send(body)


```

æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•° header å¤§å°å†™ä¸æ•æ„Ÿï¼Œå³å¯ä»¥å†™æˆ content-typeï¼Œä¹Ÿå¯ä»¥å†™æˆ Content-Typeï¼Œç”šè‡³å†™æˆ content-Typeã€‚

Content-Type çš„é»˜è®¤å€¼ä¸å…·ä½“å‘é€çš„æ•°æ®ç±»å‹æœ‰å…³ã€‚

setRequestHeader å¿…é¡»åœ¨ open()æ–¹æ³•ä¹‹åï¼Œsend()æ–¹æ³•ä¹‹å‰è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ›é”™ã€‚

setRequestHeader å¯ä»¥è°ƒç”¨å¤šæ¬¡ï¼Œæœ€ç»ˆçš„å€¼ä¸ä¼šé‡‡ç”¨è¦†ç›– override çš„æ–¹å¼ï¼Œè€Œæ˜¯é‡‡ç”¨è¿½åŠ  append çš„æ–¹å¼ã€‚

### å¦‚ä½•æŒ‡å®š xhr.response çš„æ•°æ®ç±»å‹

xhr.overrideMimeType('text/plain; charset=utf-8') // xhr level 1 ä½¿ç”¨çš„æ–¹æ³•ã€‚

xhr.responseType = 'blob' // xhr level 2 å¯ä»¥ç”¨çš„ï¼Œæ¯”ä¸Šé¢ç®€å•å¾ˆå¤šï¼Œä½†æ˜¯è¯´æ˜¯å…¼å®¹æ€§ç¨å¾®å·®ä¸€ç‚¹ç‚¹ã€‚ä¸è¿‡æˆ‘æ²¡å‘ç°è¿‡ä»»ä½•é—®é¢˜ï¼Œæ¨èç”¨ä¸‹è¾¹çš„å†™æ³•

### å¦‚ä½•è®¾ç½®è¯·æ±‚çš„è¶…æ—¶æ—¶é—´

å¦‚æœè¯·æ±‚è¿‡äº†å¾ˆä¹…è¿˜æ²¡æœ‰æˆåŠŸï¼Œä¸ºäº†ä¸ä¼šç™½ç™½å ç”¨çš„ç½‘ç»œèµ„æºï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä¸»åŠ¨ç»ˆæ­¢è¯·æ±‚ã€‚XMLHttpRequest æä¾›äº† timeout å±æ€§æ¥å…è®¸è®¾ç½®è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ã€‚
xhr.timeout = 0
å•ä½ï¼šmilliseconds æ¯«ç§’
é»˜è®¤å€¼ï¼š0ï¼Œå³ä¸è®¾ç½®è¶…æ—¶

âš ï¸ æ³¨æ„ï¼š**å½“ xhr ä¸ºä¸€ä¸ª sync åŒæ­¥è¯·æ±‚æ—¶**ï¼Œxhr.timeout å¿…é¡»ç½®ä¸º 0ï¼Œå¦åˆ™ä¼šæŠ›é”™ã€‚å¹¶ä¸” xhr.withCredentials å¿…é¡»ä¸º false

xhr.responseType å¿…é¡»ä¸º""ï¼ˆæ³¨æ„ç½®ä¸º"text"ä¹Ÿä¸å…è®¸ï¼‰

### å¦‚ä½•è·å–ä¸Šä¼ ã€ä¸‹è½½çš„è¿›åº¦

åœ¨ä¸Šä¼ æˆ–è€…ä¸‹è½½æ¯”è¾ƒå¤§çš„æ–‡ä»¶æ—¶ï¼Œå®æ—¶æ˜¾ç¤ºå½“å‰çš„ä¸Šä¼ ã€ä¸‹è½½è¿›åº¦æ˜¯å¾ˆæ™®éçš„äº§å“éœ€æ±‚ã€‚
æˆ‘ä»¬å¯ä»¥é€šè¿‡ onprogress äº‹ä»¶æ¥å®æ—¶æ˜¾ç¤ºè¿›åº¦ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªäº‹ä»¶æ¯ 50ms è§¦å‘ä¸€æ¬¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šä¼ è¿‡ç¨‹å’Œä¸‹è½½è¿‡ç¨‹è§¦å‘çš„æ˜¯ä¸åŒå¯¹è±¡çš„ onprogress äº‹ä»¶ï¼š

ä¸Šä¼ è§¦å‘çš„æ˜¯ xhr.upload å¯¹è±¡çš„ onprogress äº‹ä»¶

ä¸‹è½½è§¦å‘çš„æ˜¯ xhr å¯¹è±¡çš„ onprogress äº‹ä»¶

```

xhr.onprogress = updateProgress;
xhr.upload.onprogress = updateProgress;
function updateProgress(event) {
    if (event.lengthComputable) {
      var completedPercent = event.loaded / event.total;
    }
 }

```

### å¦‚ä½•æ‰èƒ½ä¸­æ­¢è¯·æ±‚

xhr.onreadystatechange = function () {}; //æ¸…ç†äº‹ä»¶å“åº”å‡½æ•°
xhr.abort(); //ä¸­æ­¢è¯·æ±‚

åœ¨è°ƒç”¨ abort() æ–¹æ³•å‰ï¼Œåº”å…ˆæ¸…é™¤ onreadystatechange äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå› ä¸º IE å’Œ Mozilla åœ¨è¯·æ±‚ä¸­æ­¢åä¹Ÿä¼šæ¿€æ´»è¿™ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ã€‚å¦‚æœç»™ onreadystatechange å±æ€§è®¾ç½®ä¸º nullï¼Œåˆ™ IE ä¼šå‘ç”Ÿå¼‚å¸¸ï¼Œæ‰€ä»¥ä¸ºå®ƒè®¾ç½®ä¸€ä¸ªç©ºå‡½æ•°ã€‚

### è¯·æ±‚æˆåŠŸçš„å›è°ƒ

å‰é¢å†™è¿‡ï¼Œå°±æ˜¯åœ¨ onreadystatechange åˆ¤æ–­ readyState == 4 ã€‚ã€‚ã€‚ã€‚ã€‚å»ä¸Šé¢çœ‹å“ˆ
å½“ç„¶å•¦ ï¼Œè¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œä¹Ÿæ˜¯æˆ‘æ¯”è¾ƒæ¨èçš„ï¼Œ

```
 xhr.onload = function () {
    //å¦‚æœè¯·æ±‚æˆåŠŸ
    if((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304){
      //do successCallback
    }
  }

```

### æ¯”è¾ƒå®Œæ•´çš„ http è¯·æ±‚ï¼Œæ–¹ä¾¿å¤§å®¶ç”¨çš„æ—¶å€™å¤åˆ¶ç²˜è´´ï¼Œå˜¿å˜¿

```
 let xhr = new XMLHttpRequest();
// è¯·æ±‚æˆåŠŸå›è°ƒå‡½æ•°
xhr.onload = e => {
    console.log('request success');
};
// è¯·æ±‚ç»“æŸ
xhr.onloadend = e => {
    console.log('request loadend');
};
// è¯·æ±‚å‡ºé”™
xhr.onerror = e => {
    console.log('request error');
};
// è¯·æ±‚è¶…æ—¶
xhr.ontimeout = e => {
    console.log('request timeout');
};
// è¯·æ±‚å›è°ƒå‡½æ•°.XMLHttpRequestæ ‡å‡†åˆåˆ†ä¸ºLevel 1å’ŒLevel 2,è¿™æ˜¯Level 1å’Œçš„å›è°ƒå¤„ç†æ–¹å¼
// xhr.onreadystatechange = () => {
//  if (xhr.readyState !== 4) {
//  return;
//  }
//  const status = xhr.status;
//  if ((status >= 200 && status < 300) || status === 304) {
//  console.log('request success');
//  } else {
//  console.log('request error');
//  }
//  };

xhr.timeout = 0; // è®¾ç½®è¶…æ—¶æ—¶é—´,0è¡¨ç¤ºæ°¸ä¸è¶…æ—¶
// åˆå§‹åŒ–è¯·æ±‚
xhr.open('GET/POST/DELETE/...', '/url', true || false);
// è®¾ç½®æœŸæœ›çš„è¿”å›æ•°æ®ç±»å‹ 'json' 'text' 'document' ...
xhr.responseType = '';
// è®¾ç½®è¯·æ±‚å¤´
xhr.setRequestHeader('', '');
// å‘é€è¯·æ±‚
xhr.send(null || new FormData || 'a=1&b=2' || 'jsonå­—ç¬¦ä¸²');
```

## -å°è£… XMLHttpRequest

### åˆæ­¥å°è£…

ä¸‹é¢çš„ä»£ç æœ‰ç‚¹å¤šï¼Œä¸çˆ±çœ‹å¯ä»¥ä¸çœ‹ï¼Œæ²¡ä»€ä¹ˆéš¾ç‚¹ã€‚å¤§ä½“æ€è·¯æˆ‘è¿™é‡Œå‘Šè¯‰ä½ ï¼š
å…ˆå†™ä¸€ä¸ªé»˜è®¤çš„è¯·æ±‚éœ€è¦çš„ä¸€äº›å‚æ•°å•¥çš„ï¼Œæ¯”å¦‚é»˜è®¤ get æ–¹æ³•ï¼Œé»˜è®¤å¼‚æ­¥è¯·æ±‚ç­‰ã€‚
å¦‚æœæ˜¯ get è¯·æ±‚ï¼ŒæŠŠè¯·æ±‚å‚æ•°æ”¾è¿› url é‡Œé¢æ ¼å¼ä¸º https://www.wanghaojvlao.com?wanghao=jvlao&wanghao=shadiaoè¿™æ ·
å¦‚æœæ˜¯ postï¼Œè½¬åŒ–è¯·æ±‚ä½“ä¸­çš„ date ç±»å‹ä¸ºå­—ç¬¦ä¸²ç±»å‹
å¤§æ¦‚æ€è·¯å°±æ˜¯è¿™æ ·ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï½

```
const http = {
  /**
   * jså°è£…ajaxè¯·æ±‚
   * >>ä½¿ç”¨new XMLHttpRequest åˆ›å»ºè¯·æ±‚å¯¹è±¡,æ‰€ä»¥ä¸è€ƒè™‘ä½ç«¯IEæµè§ˆå™¨(IE6åŠä»¥ä¸‹ä¸æ”¯æŒXMLHttpRequest)
   * >>ä½¿ç”¨es6è¯­æ³•,å¦‚æœéœ€è¦åœ¨æ­£å¼ç¯å¢ƒä½¿ç”¨,åˆ™å¯ä»¥ç”¨babelè½¬æ¢ä¸ºes5è¯­æ³• https://babeljs.cn/docs/setup/#installation
   *  @param settings è¯·æ±‚å‚æ•°æ¨¡ä»¿jQuery ajax
   *  è°ƒç”¨è¯¥æ–¹æ³•,dataå‚æ•°éœ€è¦å’Œè¯·æ±‚å¤´Content-Typeå¯¹åº”
   *  Content-Type                        data                                     æè¿°
   *  application/x-www-form-urlencoded   'name=å“ˆå“ˆ&age=12'æˆ–{name:'å“ˆå“ˆ',age:12}  æŸ¥è¯¢å­—ç¬¦ä¸²,ç”¨&åˆ†å‰²
   *  application/json                     name=å“ˆå“ˆ&age=12'                        jsonå­—ç¬¦ä¸²
   *  multipart/form-data                  new FormData()                           FormDataå¯¹è±¡,å½“ä¸ºFormDataç±»å‹,ä¸è¦æ‰‹åŠ¨è®¾ç½®Content-Type
   *  æ³¨æ„:è¯·æ±‚å‚æ•°å¦‚æœåŒ…å«æ—¥æœŸç±»å‹.æ˜¯å¦èƒ½è¯·æ±‚æˆåŠŸéœ€è¦åå°æ¥å£é…åˆ
   */
  ajax: (settings = {}) => {
    // åˆå§‹åŒ–è¯·æ±‚å‚æ•°
    let _s = Object.assign({
      url: '', // string
      type: 'GET', // string 'GET' 'POST' 'DELETE'
      dataType: 'json', // string æœŸæœ›çš„è¿”å›æ•°æ®ç±»å‹:'json' 'text' 'document' ...
      async: true, //  boolean true:å¼‚æ­¥è¯·æ±‚ false:åŒæ­¥è¯·æ±‚ required
      data: null, // any è¯·æ±‚å‚æ•°,dataéœ€è¦å’Œè¯·æ±‚å¤´Content-Typeå¯¹åº”
      headers: {}, // object è¯·æ±‚å¤´
      timeout: 1000, // string è¶…æ—¶æ—¶é—´:0è¡¨ç¤ºä¸è®¾ç½®è¶…æ—¶
      beforeSend: (xhr) => {
      },
      success: (result, status, xhr) => {
      },
      error: (xhr, status, error) => {
      },
      complete: (xhr, status) => {
      }
    }, settings);
    // å‚æ•°éªŒè¯
    if (!_s.url || !_s.type || !_s.dataType || !_s.async) {
      alert('å‚æ•°æœ‰è¯¯');
      return;
    }
    // åˆ›å»ºXMLHttpRequestè¯·æ±‚å¯¹è±¡
    let xhr = new XMLHttpRequest();
    // è¯·æ±‚å¼€å§‹å›è°ƒå‡½æ•°
    xhr.addEventListener('loadstart', e => {
      _s.beforeSend(xhr);
    });
    // è¯·æ±‚æˆåŠŸå›è°ƒå‡½æ•°
    xhr.addEventListener('load', e => {
      const status = xhr.status;
      if ((status >= 200 && status < 300) || status === 304) {
        let result;
        if (xhr.responseType === 'text') {
          result = xhr.responseText;
        } else if (xhr.responseType === 'document') {
          result = xhr.responseXML;
        } else {
          result = xhr.response;
        }
        // æ³¨æ„:çŠ¶æ€ç 200è¡¨ç¤ºè¯·æ±‚å‘é€/æ¥å—æˆåŠŸ,ä¸è¡¨ç¤ºä¸šåŠ¡å¤„ç†æˆåŠŸ
        _s.success(result, status, xhr);
      } else {
        _s.error(xhr, status, e);
      }
    });
    // è¯·æ±‚ç»“æŸ
    xhr.addEventListener('loadend', e => {
      _s.complete(xhr, xhr.status);
    });
    // è¯·æ±‚å‡ºé”™
    xhr.addEventListener('error', e => {
      _s.error(xhr, xhr.status, e);
    });
    // è¯·æ±‚è¶…æ—¶
    xhr.addEventListener('timeout', e => {
      _s.error(xhr, 408, e);
    });
    let useUrlParam = false;
    let sType = _s.type.toUpperCase();
    // å¦‚æœæ˜¯"ç®€å•"è¯·æ±‚,åˆ™æŠŠdataå‚æ•°ç»„è£…åœ¨urlä¸Š
    if (sType === 'GET' || sType === 'DELETE') {
      useUrlParam = true;
      _s.url += http.getUrlParam(_s.url, _s.data);
    }
    // åˆå§‹åŒ–è¯·æ±‚

    xhr.open(_s.type, _s.url, _s.async);
    // è®¾ç½®æœŸæœ›çš„è¿”å›æ•°æ®ç±»å‹
    xhr.responseType = _s.dataType;
    // è®¾ç½®è¯·æ±‚å¤´
    for (const key of Object.keys(_s.headers)) {
      xhr.setRequestHeader(key, _s.headers[key]);
    }
    // è®¾ç½®è¶…æ—¶æ—¶é—´
    if (_s.async && _s.timeout) {
      xhr.timeout = _s.timeout;
    }
    // å‘é€è¯·æ±‚.å¦‚æœæ˜¯ç®€å•è¯·æ±‚,è¯·æ±‚å‚æ•°åº”ä¸ºnull.å¦åˆ™,è¯·æ±‚å‚æ•°ç±»å‹éœ€è¦å’Œè¯·æ±‚å¤´Content-Typeå¯¹åº”
    xhr.send(useUrlParam ? null : http.getQueryData(_s.data));
  },
  // æŠŠå‚æ•°dataè½¬ä¸ºurlæŸ¥è¯¢å‚æ•°
  getUrlParam: (url, data) => {
    if (!data) {
      return '';
    }
    let paramsStr = data instanceof Object ? http.getQueryString(data) : data;
    return (url.indexOf('?') !== -1) ? paramsStr : '?' + paramsStr;
  },
  // è·å–ajaxè¯·æ±‚å‚æ•°
  getQueryData: (data) => {
    if (!data) {
      return null;
    }
    if (typeof data === 'string') {
      return data;
    }
    if (data instanceof FormData) {
      return data;
    }
    return http.getQueryString(data);
  },
  // æŠŠå¯¹è±¡è½¬ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²
  getQueryString: (data) => {
    let paramsArr = [];
    if (data instanceof Object) {
      Object.keys(data).forEach(key => {
        let val = data[key];
        // todo å‚æ•°Dateç±»å‹éœ€è¦æ ¹æ®åå°apié…Œæƒ…å¤„ç†
        if (val instanceof Date) {
          // val = dateFormat(val, 'yyyy-MM-dd hh:mm:ss');
        }
        paramsArr.push(encodeURIComponent(key) + '=' + encodeURIComponent(val));
      });
    }
    return paramsArr.join('&');
  }
}
```

è¿™æ—¶å€™è°ƒç”¨çš„ä»£ç åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

```
http.ajax({
  url: url,
  type: 'POST',
  data: {name: 'å“ˆå“ˆ', age: 12}, //æˆ– data: 'name=å“ˆå“ˆ&age=12',
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
  },
  beforeSend: (xhr) => {
    console.log('request show loading...');
  },
  success: function (result, status, xhr) {
    console.log('request success...');
  },
  error: (xhr, status, error) => {
    console.log('request error...');
  },
  complete: (xhr, status) => {
    console.log('request hide loading...');
  }
});
```

å¯ä»¥çœ‹å‡ºæ¥å“ˆï¼Œè¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œä½ æ€»ä¸èƒ½æ¯æ¬¡è¯·æ±‚éƒ½æ•´çœŸä¹ˆä¸€å¤§å †ä»£ç å§ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­å°è£…ï¼

### è¿›ä¸€æ­¥å°è£…

```
const http = {
  /**
   * æ ¹æ®å®é™…ä¸šåŠ¡æƒ…å†µè£…é¥° ajax æ–¹æ³•
   * å¦‚:ç»Ÿä¸€å¼‚å¸¸å¤„ç†,æ·»åŠ httpè¯·æ±‚å¤´,è¯·æ±‚å±•ç¤ºloadingç­‰
   * @param settings
   */
  request: (settings = {}) => {
    // ç»Ÿä¸€å¼‚å¸¸å¤„ç†å‡½æ•°
    let errorHandle = (xhr, status) => {
      console.log('request error...');
      if (status === 401) {
        console.log('request æ²¡æœ‰æƒé™...');
      }
      if (status === 408) {
        console.log('request timeout');
      }
    };
    // ä½¿ç”¨beforeæ‹¦æˆªå‚æ•°çš„ beforeSend å›è°ƒå‡½æ•°
    settings.beforeSend = (settings.beforeSend || function () {
    }).before(xhr => {
      console.log('request show loading...');
    });
    // ä¿å­˜å‚æ•°successå›è°ƒå‡½æ•°
    let successFn = settings.success;
    // è¦†ç›–å‚æ•°successå›è°ƒå‡½æ•°
    settings.success = (result, status, xhr) => {
      // todo æ ¹æ®åå°apiåˆ¤æ–­æ˜¯å¦è¯·æ±‚æˆåŠŸ
      if (result && result instanceof Object && result.code !== 1) {
        errorHandle(xhr, status);
      } else {
        console.log('request success');
        successFn && successFn(result, status, xhr);
      }
    };
    // æ‹¦æˆªå‚æ•°çš„ error
    settings.error = (settings.error || function () {
    }).before((result, status, xhr) => {
      errorHandle(xhr, status);
    });
    // æ‹¦æˆªå‚æ•°çš„ complete
    settings.complete = (settings.complete || function () {
    }).after((xhr, status) => {
      console.log('request hide loading...');
    });
    // è¯·æ±‚æ·»åŠ æƒé™å¤´,ç„¶åè°ƒç”¨http.ajaxæ–¹æ³•
    (http.ajax.before(http.addAuthorizationHeader))(settings);
  },
  // æ·»åŠ æƒé™è¯·æ±‚å¤´
  addAuthorizationHeader: (settings) => {
    settings.headers = settings.headers || {};
    const headerKey = 'Authorization'; // todo æƒé™å¤´åç§°
    // åˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨æƒé™header
    let hasAuthorization = Object.keys(settings.headers).some(key => {
      return key === headerKey;
    });
    if (!hasAuthorization) {
      settings.headers[headerKey] = 'test'; // todo ä»ç¼“å­˜ä¸­è·å–headerKeyçš„å€¼
    }
  }
};

Function.prototype.before = function (beforeFn) { // eslint-disable-line
  let _self = this;
  return function () {
    beforeFn.apply(this, arguments);
    _self.apply(this, arguments);
  };
};

Function.prototype.after = function (afterFn) { // eslint-disable-line
  let _self = this;
  return function () {
    _self.apply(this, arguments);
    afterFn.apply(this, arguments);
  };
};
```

å¥½æäº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬è°ƒç”¨çš„ä»£ç æ›´ç®€æ´äº›äº†ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š

```
http.request({
  url: url,
  type: 'POST',
  data: {name: 'å“ˆå“ˆ', age: 12}, // data: 'name=å“ˆå“ˆ&age=12',
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
  },
  success: function (result, status, xhr) {
    console.log('å°±å¯ä»¥æ“ä½œä¸€æ³¢å•¦');
  }
});




//å¯¹æ¯”ä¸‹åˆšåˆšçš„
http.ajax({
  url: url,
  type: 'POST',
  data: {name: 'å“ˆå“ˆ', age: 12}, //æˆ– data: 'name=å“ˆå“ˆ&age=12',
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
  },
  beforeSend: (xhr) => {
    console.log('request show loading...');
  },
  success: function (result, status, xhr) {
    console.log('request success...');
  },
  error: (xhr, status, error) => {
    console.log('request error...');
  },
  complete: (xhr, status) => {
    console.log('request hide loading...');
  }
});
```

å˜¿å˜¿ï¼Œä¸è¦åœï¼Œè®©æˆ‘ä»¬ç»§ç»­å°è£…ä¸€ä¸‹ï½ ğŸ˜

### ç»ˆæå°è£…

```
const http = {
  get: (url, data, successCallback, dataType = 'json') => {
    http.request({
      url: url,
      type: 'GET',
      dataType: dataType,
      data: data,
      success: successCallback
    });
  },
  delete: (url, data, successCallback, dataType = 'json') => {
    http.request({
      url: url,
      type: 'DELETE',
      dataType: dataType,
      data: data,
      success: successCallback
    });
  },
  // è°ƒç”¨æ­¤æ–¹æ³•,å‚æ•°dataåº”ä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²æˆ–æ™®é€šå¯¹è±¡
  post: (url, data, successCallback, dataType = 'json') => {
    http.request({
      url: url,
      type: 'POST',
      dataType: dataType,
      data: data,
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
      },
      success: successCallback
    });
  },
  // è°ƒç”¨æ­¤æ–¹æ³•,å‚æ•°dataåº”ä¸ºjsonå­—ç¬¦ä¸²
  postBody: (url, data, successCallback, dataType = 'json') => {
    http.request({
      url: url,
      type: 'POST',
      dataType: dataType,
      data: data,
      headers: {
        'Content-Type': 'application/json; charset=UTF-8'
      },
      success: successCallback
    });
  }
};

```

æ­¤æ—¶ï¼Œæ­¤æ—¶æ­¤åˆ»ï¼Œright now ï¼ let us see see ğŸ˜‚

```
http.get(url + '?name=å“ˆå“ˆ&age=12', null, (result, status, xhr) => {
  console.log('ä½ éšä¾¿å¹²å•¥éƒ½è¡Œå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ');
});

```

ç¥ä¼¼ jquery çš„ \$.ajax() å¯¹ä¸å¯¹ï¼Ÿå¾ˆå¼€å¿ƒäº†è§£äº†è¿™ä¹ˆå¤šä¸œè¥¿å§ï½ï¼Œok é‚£ä¹ˆæˆ‘ä»¬æ¥ç€çœ‹ä¸‹ä¸€ä¸ªç©æ„å„¿ï½

## -axios

### axios ç®€ä»‹

Axios æ˜¯ä¸€ä¸ªåŸºäº promise çš„ HTTP åº“ï¼Œå¯ä»¥ç”¨åœ¨æµè§ˆå™¨å’Œ node.js ä¸­ã€‚

**ç‰¹æ€§ï¼š**

- ä»æµè§ˆå™¨ä¸­åˆ›å»º XMLHttpRequests
- ä» node.js åˆ›å»º http è¯·æ±‚
- æ”¯æŒ Promise API
- æ‹¦æˆªè¯·æ±‚å’Œå“åº”
- è½¬æ¢è¯·æ±‚æ•°æ®å’Œå“åº”æ•°æ®
- å–æ¶ˆè¯·æ±‚
- è‡ªåŠ¨è½¬æ¢ JSON æ•°æ®
- å®¢æˆ·ç«¯æ”¯æŒé˜²å¾¡ XSRF

é‚£ä¹ˆ axios å’Œ ajax çš„åŒºåˆ«åœ¨å“ªé‡Œå‘¢ï¼Ÿaxios å’Œ XMLHttpRequest å…³è”åˆåœ¨å“ªé‡Œå‘¢ï¼Ÿ
Axios åœ¨ NPM ä¸Šçš„æè¿°æ˜¯ï¼šPromise based HTTP client for the browser and node.jsï¼Œæ˜¯ä¸€ç§åŸºäº Promise å°è£…çš„ HTTP å®¢æˆ·ç«¯ã€‚
AJAX å®Œæ•´æ˜¯ Asynchronous Javascript And XML . å¼‚æ­¥ js å’Œ xmlï¼Œæ˜¯ä¸€ç§å¼‚æ­¥è¯·æ±‚çš„æŠ€æœ¯ã€‚

å•¥æ„æ€ï¼ŸAxios æ˜¯é€šè¿‡ Promise å®ç° XHR å°è£…ï¼Œå…¶ä¸­ Promise æ˜¯æ§åˆ¶æ‰‹æ®µï¼ŒXHR æ˜¯å®é™…å‘é€ Http è¯·æ±‚çš„å®¢æˆ·ç«¯ã€‚å°±åƒ\$.ajax æ˜¯é€šè¿‡ callback+XHR å®ç°ä¸€æ ·å°±åƒæˆ‘ä»¬åˆšåˆšåœ¨ä¸Šé¢å°è£…çš„é‚£ä¸ªä¸€ä¸ªæ„æ€çš„ï¼Œéƒ½æ˜¯ AJAX æŠ€æœ¯çš„ä¸€ç§è¿ç”¨ã€‚ AJAX æŠ€æœ¯æ˜¯å®ç°ç½‘é¡µçš„å±€éƒ¨æ•°æ®åˆ·æ–°ï¼Œä½ å¯ä»¥é€šè¿‡ XHRã€Fetchã€WebSocket ç­‰ API å®ç°ã€‚

### ä½¿ç”¨æ–¹æ³•

ç¡¬æ ¸ä¸€ç‚¹ï¼Œç›´æ¥ä¸Šå®˜ç½‘ä»£ç ï¼Œä¸€ç›®äº†ç„¶ï½

```
// get
axios.get('/user', {
    params: {
      ID: 12345
    }
  })
  .then(function (response) {
    console.log(response);
  })
  .catch(function (error) {
    console.log(error);
  });

// post
axios.post('/user', {
    firstName: 'Fred',
    lastName: 'Flintstone'
  })
  .then(function (response) {
    console.log(response);
  })
  .catch(function (error) {
    console.log(error);
  });

// å¹¶å‘
function getUserAccount() {
  return axios.get('/user/12345');
}

function getUserPermissions() {
  return axios.get('/user/12345/permissions');
}

axios.all([getUserAccount(), getUserPermissions()])
  .then(axios.spread(function (acct, perms) {
    // ä¸¤ä¸ªè¯·æ±‚ç°åœ¨éƒ½æ‰§è¡Œå®Œæˆ
  }));
```

### axios çš„è¯·æ±‚é…ç½®

1ã€å¯ä»¥é€šè¿‡ axios.defaults è®¾ç½®å…¨å±€é»˜è®¤å€¼ï¼Œåœ¨æ‰€æœ‰è¯·æ±‚ä¸­éƒ½ç”Ÿæ•ˆã€‚

```
axios.defaults.headers.common["token"] = ""
axios.defaults.headers.post["Content-type"] = "application/json"
axios.defaults.baseURL = 'https://zhujun.zhenhao.com; //è®¾ç½®ç»Ÿä¸€è·¯å¾„å‰ç¼€
```

2ã€ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å®ä¾‹çš„é»˜è®¤å€¼ï¼Œä»¥åŠä¿®æ”¹å®ä¾‹çš„é…ç½®

```
let ax = axios.create({
  baseURL: 'http://zhujun.zhenbang.com',
  params: { name: 'æœ±å†›' }
});
// ä¿®æ”¹é…ç½®åï¼Œè¶…æ—¶è®¾ç½®ä¸º4ç§’
ax.defaults.timeout = 4000;
```

3ã€ä¹Ÿå¯ä»¥åœ¨æ¯ä¸ªè¯·æ±‚ä¸­è®¾ç½®ç›¸å…³çš„é…ç½®ã€‚

```
axios('/app/mock/zhujun', {
  params: {
    name: 'æœ±å†›'
  },
  baseURL: 'http://zhujun.zhenshuai.com'
})
```

```
{
   // `url` æ˜¯ç”¨äºè¯·æ±‚çš„æœåŠ¡å™¨ URL
  url: '/user',

  // `method` æ˜¯åˆ›å»ºè¯·æ±‚æ—¶ä½¿ç”¨çš„æ–¹æ³•
  method: 'get', // default

  // `baseURL` å°†è‡ªåŠ¨åŠ åœ¨ `url` å‰é¢ï¼Œé™¤é `url` æ˜¯ä¸€ä¸ªç»å¯¹ URLã€‚
  // å®ƒå¯ä»¥é€šè¿‡è®¾ç½®ä¸€ä¸ª `baseURL` ä¾¿äºä¸º axios å®ä¾‹çš„æ–¹æ³•ä¼ é€’ç›¸å¯¹ URL
  baseURL: 'https://some-domain.com/api/',

  // `transformRequest` å…è®¸åœ¨å‘æœåŠ¡å™¨å‘é€å‰ï¼Œä¿®æ”¹è¯·æ±‚æ•°æ®
  // åªèƒ½ç”¨åœ¨ 'PUT', 'POST' å’Œ 'PATCH' è¿™å‡ ä¸ªè¯·æ±‚æ–¹æ³•
  // åé¢æ•°ç»„ä¸­çš„å‡½æ•°å¿…é¡»è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæˆ– ArrayBufferï¼Œæˆ– Stream
  transformRequest: [function (data, headers) {
    // å¯¹ data è¿›è¡Œä»»æ„è½¬æ¢å¤„ç†
    return data;
  }],

  // `transformResponse` åœ¨ä¼ é€’ç»™ then/catch å‰ï¼Œå…è®¸ä¿®æ”¹å“åº”æ•°æ®
  transformResponse: [function (data) {
    // å¯¹ data è¿›è¡Œä»»æ„è½¬æ¢å¤„ç†
    return data;
  }],

  // `headers` æ˜¯å³å°†è¢«å‘é€çš„è‡ªå®šä¹‰è¯·æ±‚å¤´
  headers: {'X-Requested-With': 'XMLHttpRequest'},

  // `params` æ˜¯å³å°†ä¸è¯·æ±‚ä¸€èµ·å‘é€çš„ URL å‚æ•°
  // å¿…é¡»æ˜¯ä¸€ä¸ªæ— æ ¼å¼å¯¹è±¡(plain object)æˆ– URLSearchParams å¯¹è±¡
  params: {
    ID: 12345
  },

   // `paramsSerializer` æ˜¯ä¸€ä¸ªè´Ÿè´£ `params` åºåˆ—åŒ–çš„å‡½æ•°
  // (e.g. https://www.npmjs.com/package/qs, http://api.jquery.com/jquery.param/)
  paramsSerializer: function(params) {
    return Qs.stringify(params, {arrayFormat: 'brackets'})
  },

  // `data` æ˜¯ä½œä¸ºè¯·æ±‚ä¸»ä½“è¢«å‘é€çš„æ•°æ®
  // åªé€‚ç”¨äºè¿™äº›è¯·æ±‚æ–¹æ³• 'PUT', 'POST', å’Œ 'PATCH'
  // åœ¨æ²¡æœ‰è®¾ç½® `transformRequest` æ—¶ï¼Œå¿…é¡»æ˜¯ä»¥ä¸‹ç±»å‹ä¹‹ä¸€ï¼š
  // - string, plain object, ArrayBuffer, ArrayBufferView, URLSearchParams
  // - æµè§ˆå™¨ä¸“å±ï¼šFormData, File, Blob
  // - Node ä¸“å±ï¼š Stream
  data: {
    firstName: 'Fred'
  },

  // `timeout` æŒ‡å®šè¯·æ±‚è¶…æ—¶çš„æ¯«ç§’æ•°(0 è¡¨ç¤ºæ— è¶…æ—¶æ—¶é—´)
  // å¦‚æœè¯·æ±‚è¯è´¹äº†è¶…è¿‡ `timeout` çš„æ—¶é—´ï¼Œè¯·æ±‚å°†è¢«ä¸­æ–­
  timeout: 1000,

   // `withCredentials` è¡¨ç¤ºè·¨åŸŸè¯·æ±‚æ—¶æ˜¯å¦éœ€è¦ä½¿ç”¨å‡­è¯
  withCredentials: false, // default

  // `adapter` å…è®¸è‡ªå®šä¹‰å¤„ç†è¯·æ±‚ï¼Œä»¥ä½¿æµ‹è¯•æ›´è½»æ¾
  // è¿”å›ä¸€ä¸ª promise å¹¶åº”ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„å“åº” (æŸ¥é˜… [response docs](#response-api)).
  adapter: function (config) {
    /* ... */
  },

 // `auth` è¡¨ç¤ºåº”è¯¥ä½¿ç”¨ HTTP åŸºç¡€éªŒè¯ï¼Œå¹¶æä¾›å‡­æ®
  // è¿™å°†è®¾ç½®ä¸€ä¸ª `Authorization` å¤´ï¼Œè¦†å†™æ‰ç°æœ‰çš„ä»»æ„ä½¿ç”¨ `headers` è®¾ç½®çš„è‡ªå®šä¹‰ `Authorization`å¤´
  auth: {
    username: 'janedoe',
    password: 's00pers3cret'
  },

   // `responseType` è¡¨ç¤ºæœåŠ¡å™¨å“åº”çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥æ˜¯ 'arraybuffer', 'blob', 'document', 'json', 'text', 'stream'
  responseType: 'json', // default

  // `responseEncoding` indicates encoding to use for decoding responses
  // Note: Ignored for `responseType` of 'stream' or client-side requests
  responseEncoding: 'utf8', // default

   // `xsrfCookieName` æ˜¯ç”¨ä½œ xsrf token çš„å€¼çš„cookieçš„åç§°
  xsrfCookieName: 'XSRF-TOKEN', // default

  // `xsrfHeaderName` is the name of the http header that carries the xsrf token value
  xsrfHeaderName: 'X-XSRF-TOKEN', // default

   // `onUploadProgress` å…è®¸ä¸ºä¸Šä¼ å¤„ç†è¿›åº¦äº‹ä»¶
  onUploadProgress: function (progressEvent) {
    // Do whatever you want with the native progress event
  },

  // `onDownloadProgress` å…è®¸ä¸ºä¸‹è½½å¤„ç†è¿›åº¦äº‹ä»¶
  onDownloadProgress: function (progressEvent) {
    // å¯¹åŸç”Ÿè¿›åº¦äº‹ä»¶çš„å¤„ç†
  },

   // `maxContentLength` å®šä¹‰å…è®¸çš„å“åº”å†…å®¹çš„æœ€å¤§å°ºå¯¸
  maxContentLength: 2000,

  // `validateStatus` å®šä¹‰å¯¹äºç»™å®šçš„HTTP å“åº”çŠ¶æ€ç æ˜¯ resolve æˆ– reject  promise ã€‚å¦‚æœ `validateStatus` è¿”å› `true` (æˆ–è€…è®¾ç½®ä¸º `null` æˆ– `undefined`)ï¼Œpromise å°†è¢« resolve; å¦åˆ™ï¼Œpromise å°†è¢« rejecte
  validateStatus: function (status) {
    return status >= 200 && status < 300; // default
  },

  // `maxRedirects` å®šä¹‰åœ¨ node.js ä¸­ follow çš„æœ€å¤§é‡å®šå‘æ•°ç›®
  // å¦‚æœè®¾ç½®ä¸º0ï¼Œå°†ä¸ä¼š follow ä»»ä½•é‡å®šå‘
  maxRedirects: 5, // default

  // `socketPath` defines a UNIX Socket to be used in node.js.
  // e.g. '/var/run/docker.sock' to send requests to the docker daemon.
  // Only either `socketPath` or `proxy` can be specified.
  // If both are specified, `socketPath` is used.
  socketPath: null, // default

  // `httpAgent` å’Œ `httpsAgent` åˆ†åˆ«åœ¨ node.js ä¸­ç”¨äºå®šä¹‰åœ¨æ‰§è¡Œ http å’Œ https æ—¶ä½¿ç”¨çš„è‡ªå®šä¹‰ä»£ç†ã€‚å…è®¸åƒè¿™æ ·é…ç½®é€‰é¡¹ï¼š
  // `keepAlive` é»˜è®¤æ²¡æœ‰å¯ç”¨
  httpAgent: new http.Agent({ keepAlive: true }),
  httpsAgent: new https.Agent({ keepAlive: true }),

  // 'proxy' å®šä¹‰ä»£ç†æœåŠ¡å™¨çš„ä¸»æœºåç§°å’Œç«¯å£
  // `auth` è¡¨ç¤º HTTP åŸºç¡€éªŒè¯åº”å½“ç”¨äºè¿æ¥ä»£ç†ï¼Œå¹¶æä¾›å‡­æ®
  // è¿™å°†ä¼šè®¾ç½®ä¸€ä¸ª `Proxy-Authorization` å¤´ï¼Œè¦†å†™æ‰å·²æœ‰çš„é€šè¿‡ä½¿ç”¨ `header` è®¾ç½®çš„è‡ªå®šä¹‰ `Proxy-Authorization` å¤´ã€‚
  proxy: {
    host: '127.0.0.1',
    port: 9000,
    auth: {
      username: 'mikeymike',
      password: 'rapunz3l'
    }
  },

  // `cancelToken` æŒ‡å®šç”¨äºå–æ¶ˆè¯·æ±‚çš„ cancel token
  // ï¼ˆæŸ¥çœ‹åé¢çš„ Cancellation è¿™èŠ‚äº†è§£æ›´å¤šï¼‰
  cancelToken: new CancelToken(function (cancel) {
  })
}
```

#### æ‹¦æˆªå™¨

å¯ä»¥åˆ†åˆ«è®¾ç½®è¯·æ±‚æ‹¦æˆªå’Œå“åº”æ‹¦æˆªï¼Œåœ¨å‘å‡ºè¯·æ±‚å’Œå“åº”åˆ°è¾¾ then ä¹‹å‰è¿›è¡Œåˆ¤æ–­å¤„ç†ã€‚

```
axios.interceptors.response.use(
  res => {
    if (res) {
      return res;
    }
  },
  err => {
    return Promise.reject(error);
  }
);
```

æŠŠä¸Šé¢çš„ response æ¢æˆ request å°±æ˜¯è¯·æ±‚å‘å‡ºå‰çš„æ‹¦æˆªå™¨ï½
æ‹¦æˆªå™¨æ˜¯å¯ä»¥ç§»é™¤çš„ï¼Œåœ¨ç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼Œä¼šç”¨åˆ°ç§»é™¤æ‹¦æˆªå™¨ã€‚ï¼ˆæˆ‘å…¶å®ä¹Ÿä¸çŸ¥é“å•¥æƒ…å†µéœ€è¦å¦‚æ­¤è«åå…¶å¦™çš„æ“ä½œï¼‰

```
const clearInterceptors = axios.interceptors.request.use(function () {});
axios.interceptors.request.eject(clearInterceptors);
// ç§»é™¤æ‹¦æˆªå™¨ï¼Œå’Œç§»é™¤jså®šæ—¶å™¨ä¸€æ ·ã€‚
```

### è·¨åŸŸé…ç½®

### EXTRA

æ•´ç‚¹é¢å¤–çš„æƒŠå–œï¼Œç¡¬æ ¸èµ·æ¥ä¸Šä»£ç ï¼

````

import axios from 'axios';
import { getLocale } from 'umi-plugin-react/locale';
import { getToken } from '../token';

// Add a request interceptor è¿™æ˜¯åŠ ä¸ªæ‹¦æˆªå™¨ï¼Œåœ¨ request å‘å‡ºè¯·æ±‚ä¹‹å‰ï¼Œå¯ä»¥åšä¸€äº›æ“ä½œçš„ï½
axios.interceptors.request.use(
function(config) {
// Do something before request is sent
return config;
},
function(error) {
// Do something with request error
return Promise.reject(error);
}
);

// Add a response interceptor è¿™ä¹Ÿæ˜¯ä¸ªæ‹¦æˆªï¼Œåœ¨å“åº”åˆ°è¾¾ then ä¹‹å‰ä¹Ÿå¯ä»¥æ“ä½œä¸€æ³¢ï¼Œè¿™é‡Œåšäº†ä¸ªå¦‚æœè¯·æ±‚å¤±è´¥ï¼Œè‡ªåŠ¨é‡æ–°è¯·æ±‚çš„æ“ä½œ
axios.interceptors.response.use(
function(response) {
// Do something with response data
return response;
},
function(error) {
// Do something with response error
const { config, response } = error;
if (config) {
if (
config.retry &&
['get', 'put', 'delete'].includes(config.method) &&
(!response || (response.status >= 500 && response.status <= 599))
) {
const { headers } = config;
const retryCountHeaderKey = 'X-Retry-Count';
const retryCountHeaderValue = parseInt(headers[retryCountHeaderKey] || '0', 10) + 1;
if (retryCountHeaderValue <= 3) { // å¦‚æœå¤±è´¥ï¼Œè‡ªåŠ¨è¯·æ±‚ 3 æ¬¡
return new Promise(resolve => {
setTimeout(
() =>
resolve(
axios({
...config,
headers: {
...headers,
[retryCountHeaderKey]: `${retryCountHeaderValue}`,
},
})
),
1000 \* retryCountHeaderValue
);
});
}
} // é‡å‘â€œå®‰å…¨è¯·æ±‚â€
}
return Promise.reject(error);
}
);

/\*\*

- request æ–¹æ³•ï¼Œaxios çš„ç®€å•å°è£…
  \*/
  export default function request(url, config = {}) {
  axios.defaults.headers.common.Authorization = getToken(); // è·å– token
  axios.defaults.headers.common['Accept-Language'] = `${getLocale()};q=0.9`; // å›½é™…åŒ–â€œAccept-Language:zh-CN,zh;q=0.9â€ => zh-CN æˆ– en-US

const {
method = 'get',
responseType,
body = {},
headers = {},
cache = false,
download = false,
retry = true, // eslint-disable-line
...rest
} = config;

const newBody = /(put|post|patch)/i.test(method) ? { data: body } : { params: body }; // data å‚æ•°ï¼Œåœ¨ä»¥ä¸‹â€œè¯·æ±‚ç±»å‹â€ä¸­å¯ç”¨ï¼šput, post, patch

const newResponseType = responseType || (download ? 'arraybuffer' : 'json');

return axios
.request({
url, // URL åœ°å€
method, // è¯·æ±‚ç±»å‹ï¼Œget, post, put, delete...
responseType: newResponseType, // å“åº”æ•°æ®ç±»å‹

      headers: {
        ...headers,
        ...(cache
          ? { 'Cache-Control': 'public, max-age=86400' }
          : { 'Cache-Control': 'no-cache, no-store, must-revalidate', Pragma: 'no-cache' }),
      },

      ...newBody, // è¯·æ±‚å‚æ•°

      ...rest, // å‰©ä½™å‚æ•°
    })
    .then(response => ({
      success: true,
      response,
    }))
    .catch(error => {
      const { response } = error;
      const { status } = response;

      const errorName = `Error${status} - ${response.config.url}`;
      const errorMessage = response.statusText;
      console.log(errorName);
      console.log(errorMessage);

// å¦‚æœä¸æ˜¯ç™»é™†é¡µï¼Œä½†æ˜¯çŠ¶æ€ç  401 é‚£ä¹ˆè·³è½¬é¡µé¢åˆ°ç™»é™†é¡µ
if (window.location.href.indexOf('login') === -1 && status === 401) {
window.location.href = `/g/login?redirect=${ window.location.href.split(window.location.host)[1] }`;
}

      return {
        success: false,
        response: { ...response, data: response.data || { message: '504 Gateway Timeout' } },
      };
    });

}

```

#### åœ¨é¡¹ç›®ä¸­çš„ç”¨æ³•

```

         onClick={() => {
              this.setState({
                spinning: true,
              });
              request(`/server/api/declarationfiles/${record.id}`, {
                method: 'get',
                download: true,
                onDownloadProgress: e => {
                  if (e.loaded / e.total === 1) {
                    this.setState({
                      spinning: false,
                    });
                  }
                },
              }).then(wrappedResponse => {
                const { response } = wrappedResponse;
                download(record.fileName, response.data);
              });
            }}


                //  ç›´æ¥åœ¨é¡µé¢é‡Œå†™è¯·æ±‚ï¼Œé€‚ç”¨äºè°ƒç”¨æ¬¡æ•°å°‘ï¼Œç‹¬ç«‹ä¸“å±äºæŸä¸ªé¡µé¢ä½¿ç”¨çš„æƒ…å†µã€‚æ¯”å¦‚æ–‡ä»¶ä¸‹è½½ç­‰

```

---

```

\*retrieveRules({ payload }, { call, put, select }) {
const newRules = yield select(models => {
const { pagination, searcher } = models[namespace];
return {
pagination,
searcher,
...payload,
};
});
const { pagination, searcher } = newRules;
const wrappedResponse = yield call(request, `/server/api/projectwarningrules`, {
method: 'get',
body: {
...pagination,
...searcher,
},
});
}

               // å†™åœ¨model å±‚çš„effecté‡Œé¢ï¼Œé€‚ç”¨äºè°ƒç”¨æ¬¡æ•°å¤šï¼Œ æ¯”å¦‚è¯·æ±‚åˆ—è¡¨æ•°æ®ï¼Œå¢åˆ æ”¹æŸ¥æ“ä½œåéœ€è¦å†æ¬¡è°ƒç”¨è¯·æ±‚æ•°æ®

```

```
````
